<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Colton Volunteer Fire Department</title>
<link href="https://fonts.googleapis.com/css2?family=Sora:wght@300;400;500;600;700;800&family=DM+Sans:wght@300;400;500;600&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-auth-compat.js"></script>
<style>
  :root {
    --bg-deep: #080810;
    --bg-mid: #0e0e1a;
    --bg-surface: #13131f;
    --glass: rgba(255,255,255,0.045);
    --glass-border: rgba(255,255,255,0.08);
    --glass-hover: rgba(255,255,255,0.075);
    --red: #E63946;
    --red-glow: rgba(230,57,70,0.35);
    --gold: #F4A261;
    --gold-glow: rgba(244,162,97,0.3);
    --green: #2ECC71;
    --green-glow: rgba(46,204,113,0.35);
    --amber: #F39C12;
    --amber-glow: rgba(243,156,18,0.35);
    --blue: #4A9EFF;
    --text-primary: #FFFFFF;
    --text-secondary: rgba(255,255,255,0.55);
    --text-tertiary: rgba(255,255,255,0.3);
    --sidebar-w: 240px;
    --radius: 18px;
    --radius-sm: 12px;
  }

  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'DM Sans', sans-serif;
    background: var(--bg-deep);
    color: var(--text-primary);
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* ‚îÄ‚îÄ ANIMATIONS ‚îÄ‚îÄ */
  @keyframes pulse-ring {
    0% { transform: scale(0.85); opacity: 1; }
    100% { transform: scale(2.4); opacity: 0; }
  }
  @keyframes float-ember {
    0% { transform: translateY(0) translateX(0) rotate(0deg); opacity: 0; }
    10% { opacity: 1; }
    90% { opacity: 0.6; }
    100% { transform: translateY(-120vh) translateX(var(--dx)) rotate(720deg); opacity: 0; }
  }
  @keyframes fade-up {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }
  @keyframes slide-in-right {
    from { opacity: 0; transform: translateX(30px); }
    to { opacity: 1; transform: translateX(0); }
  }
  @keyframes shake {
    0%,100% { transform: translateX(0); }
    15% { transform: translateX(-10px); }
    30% { transform: translateX(10px); }
    45% { transform: translateX(-8px); }
    60% { transform: translateX(8px); }
    75% { transform: translateX(-4px); }
    90% { transform: translateX(4px); }
  }
  @keyframes shimmer {
    0% { background-position: -200% 0; }
    100% { background-position: 200% 0; }
  }
  @keyframes scale-in {
    from { opacity: 0; transform: scale(0.92); }
    to { opacity: 1; transform: scale(1); }
  }
  @keyframes toast-in {
    from { opacity: 0; transform: translateX(120%); }
    to { opacity: 1; transform: translateX(0); }
  }
  @keyframes glow-pulse {
    0%,100% { box-shadow: 0 0 20px var(--red-glow); }
    50% { box-shadow: 0 0 40px var(--red-glow), 0 0 80px var(--red-glow); }
  }

  /* ‚îÄ‚îÄ GLASS CARD ‚îÄ‚îÄ */
  .glass {
    background: var(--glass);
    backdrop-filter: blur(28px) saturate(180%);
    -webkit-backdrop-filter: blur(28px) saturate(180%);
    border: 1px solid var(--glass-border);
    border-radius: var(--radius);
    box-shadow: 0 8px 32px rgba(0,0,0,0.5), inset 0 1px 0 rgba(255,255,255,0.07);
  }
  .glass:hover { background: var(--glass-hover); }

  /* ‚îÄ‚îÄ STATUS DOTS ‚îÄ‚îÄ */
  .dot {
    position: relative;
    width: 11px; height: 11px;
    border-radius: 50%;
    flex-shrink: 0;
  }
  .dot::before {
    content: '';
    position: absolute;
    inset: -3px;
    border-radius: 50%;
    background: inherit;
    animation: pulse-ring 1.8s ease-out infinite;
    opacity: 0.7;
  }
  .dot.green { background: var(--green); box-shadow: 0 0 8px var(--green-glow); }
  .dot.red { background: var(--red); box-shadow: 0 0 8px var(--red-glow); }
  .dot.amber { background: var(--amber); box-shadow: 0 0 8px var(--amber-glow); }

  /* ‚îÄ‚îÄ BACKGROUND MESH ‚îÄ‚îÄ */
  .bg-mesh {
    position: fixed; inset: 0; z-index: 0; pointer-events: none;
    background:
      radial-gradient(ellipse 80% 50% at 20% 20%, rgba(230,57,70,0.06) 0%, transparent 60%),
      radial-gradient(ellipse 60% 40% at 80% 80%, rgba(244,162,97,0.04) 0%, transparent 60%),
      radial-gradient(ellipse 50% 60% at 50% 50%, rgba(74,158,255,0.03) 0%, transparent 70%);
  }

  /* ‚îÄ‚îÄ EMBERS ‚îÄ‚îÄ */
  .ember {
    position: fixed;
    bottom: -20px;
    width: 4px; height: 4px;
    border-radius: 50%;
    pointer-events: none;
    z-index: 0;
    animation: float-ember linear infinite;
  }

  /* ‚îÄ‚îÄ AUTH SCREEN ‚îÄ‚îÄ */
  #auth-screen {
    position: fixed; inset: 0; z-index: 100;
    display: flex; align-items: center; justify-content: center;
    padding: 20px;
    background: var(--bg-deep);
  }
  .auth-bg {
    position: absolute; inset: 0;
    background:
      radial-gradient(ellipse 70% 50% at 30% 40%, rgba(230,57,70,0.12) 0%, transparent 60%),
      radial-gradient(ellipse 50% 40% at 70% 70%, rgba(244,162,97,0.07) 0%, transparent 60%);
  }
  .auth-card {
    position: relative; z-index: 1;
    width: 100%; max-width: 400px;
    padding: 40px 36px;
    animation: scale-in 0.5s cubic-bezier(0.34,1.56,0.64,1);
    background: rgba(10,10,20,0.75) !important;
    backdrop-filter: blur(48px) saturate(200%) !important;
    -webkit-backdrop-filter: blur(48px) saturate(200%) !important;
    border: 1px solid rgba(255,255,255,0.1) !important;
    border-radius: 28px !important;
    box-shadow: 0 20px 60px rgba(0,0,0,0.7), 0 0 0 0.5px rgba(255,255,255,0.05) inset !important;
  }
  .dept-badge {
    width: 72px; height: 72px;
    border-radius: 20px;
    background: linear-gradient(135deg, var(--red) 0%, #c0392b 100%);
    display: flex; align-items: center; justify-content: center;
    font-size: 32px;
    margin: 0 auto 20px;
    box-shadow: 0 8px 32px var(--red-glow), inset 0 1px 0 rgba(255,255,255,0.2);
    animation: glow-pulse 3s ease-in-out infinite;
  }
  .auth-title {
    font-family: 'Sora', sans-serif;
    font-size: 22px; font-weight: 700;
    text-align: center; letter-spacing: -0.3px;
    margin-bottom: 4px;
  }
  .auth-sub {
    font-size: 13px; color: var(--text-secondary);
    text-align: center; margin-bottom: 28px;
  }

  /* Select dropdown */
  .select-wrap { position: relative; margin-bottom: 16px; }
  .select-wrap select {
    width: 100%; padding: 14px 42px 14px 16px;
    background: rgba(255,255,255,0.06);
    border: 1px solid var(--glass-border);
    border-radius: var(--radius-sm);
    color: var(--text-primary);
    font-family: 'DM Sans', sans-serif;
    font-size: 15px;
    appearance: none; cursor: pointer;
    outline: none;
    transition: border-color 0.2s, background 0.2s;
  }
  .select-wrap select:focus {
    border-color: rgba(230,57,70,0.5);
    background: rgba(255,255,255,0.09);
  }
  .select-arrow {
    position: absolute; right: 14px; top: 50%; transform: translateY(-50%);
    pointer-events: none; color: var(--text-secondary); font-size: 12px;
  }
  .select-wrap select option { background: #1a1a2e; color: white; }

  /* PIN pad */
  #pin-section { display: none; }
  #pin-section.visible { display: block; animation: fade-up 0.35s ease; }
  .pin-display {
    display: flex; align-items: center; justify-content: center;
    gap: 12px; margin: 20px 0;
  }
  .pin-dot-display {
    width: 14px; height: 14px; border-radius: 50%;
    background: rgba(255,255,255,0.15);
    border: 1.5px solid rgba(255,255,255,0.25);
    transition: all 0.15s ease;
  }
  .pin-dot-display.filled {
    background: var(--red);
    border-color: var(--red);
    box-shadow: 0 0 10px var(--red-glow);
  }
  .pin-grid {
    display: grid; grid-template-columns: repeat(3, 1fr);
    gap: 10px; margin-bottom: 16px;
  }
  .pin-btn {
    aspect-ratio: 1;
    background: rgba(255,255,255,0.07);
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 50%;
    color: white;
    font-family: 'Sora', sans-serif;
    font-size: 20px; font-weight: 500;
    cursor: pointer;
    transition: all 0.1s ease;
    display: flex; align-items: center; justify-content: center;
    min-height: 64px;
    -webkit-tap-highlight-color: transparent;
  }
  .pin-btn:hover {
    background: rgba(255,255,255,0.13);
    transform: scale(1.04);
  }
  .pin-btn:active {
    transform: scale(0.92);
    background: rgba(230,57,70,0.3);
    border-color: var(--red);
  }
  .pin-btn.del { font-size: 18px; }
  .pin-btn.empty { pointer-events: none; opacity: 0; }
  .auth-card.shake { animation: shake 0.4s ease; }
  .auth-card.success { border-color: rgba(46,204,113,0.5); box-shadow: 0 8px 32px rgba(46,204,113,0.2); }

  .btn-primary {
    width: 100%; padding: 14px;
    background: linear-gradient(135deg, var(--red) 0%, #c0392b 100%);
    border: none; border-radius: var(--radius-sm);
    color: white;
    font-family: 'Sora', sans-serif;
    font-size: 15px; font-weight: 600;
    cursor: pointer; letter-spacing: 0.3px;
    transition: all 0.2s ease;
    box-shadow: 0 4px 20px var(--red-glow);
  }
  .btn-primary:hover { transform: translateY(-1px); box-shadow: 0 8px 30px var(--red-glow); }
  .btn-primary:active { transform: scale(0.98); }

  .btn-ghost {
    width: 100%; padding: 12px;
    background: transparent;
    border: 1px solid var(--glass-border);
    border-radius: var(--radius-sm);
    color: var(--text-secondary);
    font-family: 'DM Sans', sans-serif;
    font-size: 14px; cursor: pointer;
    transition: all 0.2s; margin-top: 10px;
  }
  .btn-ghost:hover { color: white; border-color: rgba(255,255,255,0.2); background: var(--glass); }

  /* ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ */
  .modal-overlay {
    display: none; position: fixed; inset: 0; z-index: 200;
    background: rgba(0,0,0,0.7);
    backdrop-filter: blur(8px);
    align-items: center; justify-content: center; padding: 20px;
  }
  .modal-overlay.open { display: flex; animation: fade-up 0.2s ease; }
  .modal {
    width: 100%; max-width: 460px;
    padding: 32px 28px;
    background: rgba(15,15,25,0.95);
    backdrop-filter: blur(40px);
    border: 1px solid var(--glass-border);
    border-radius: 22px;
    box-shadow: 0 20px 80px rgba(0,0,0,0.7);
    animation: scale-in 0.3s cubic-bezier(0.34,1.56,0.64,1);
  }
  .modal-title {
    font-family: 'Sora', sans-serif;
    font-size: 20px; font-weight: 700; margin-bottom: 6px;
  }
  .modal-sub { font-size: 13px; color: var(--text-secondary); margin-bottom: 24px; }
  .field { margin-bottom: 14px; }
  .field label { display: block; font-size: 12px; font-weight: 500; color: var(--text-secondary); margin-bottom: 6px; letter-spacing: 0.5px; text-transform: uppercase; }
  .field input, .field select {
    width: 100%; padding: 12px 14px;
    background: rgba(255,255,255,0.06);
    border: 1px solid var(--glass-border);
    border-radius: 10px;
    color: white;
    font-family: 'DM Sans', sans-serif; font-size: 14px;
    outline: none; transition: border-color 0.2s;
  }
  .field input:focus, .field select:focus { border-color: rgba(230,57,70,0.5); }
  .field input::placeholder { color: var(--text-tertiary); }
  .field select option { background: #1a1a2e; }
  .modal-actions { display: flex; gap: 10px; margin-top: 20px; }
  .btn-sm {
    flex: 1; padding: 11px;
    border-radius: 10px; font-family: 'Sora', sans-serif;
    font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.2s;
    border: none;
  }
  .btn-sm.primary { background: linear-gradient(135deg, var(--red), #c0392b); color: white; box-shadow: 0 4px 14px var(--red-glow); }
  .btn-sm.secondary { background: rgba(255,255,255,0.07); border: 1px solid var(--glass-border); color: var(--text-secondary); }
  .btn-sm:hover { transform: translateY(-1px); }
  .btn-sm.primary:hover { box-shadow: 0 8px 24px var(--red-glow); }

  /* ‚îÄ‚îÄ MAIN LAYOUT ‚îÄ‚îÄ */
  #app { display: none; height: 100vh; position: relative; z-index: 1; }
  #app.visible { display: flex; }

  /* ‚îÄ‚îÄ SIDEBAR ‚îÄ‚îÄ */
  .sidebar {
    width: var(--sidebar-w);
    background: rgba(10,10,20,0.75);
    backdrop-filter: blur(48px) saturate(200%);
    -webkit-backdrop-filter: blur(48px) saturate(200%);
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 24px;
    box-shadow: 0 8px 40px rgba(0,0,0,0.6), 0 0 0 0.5px rgba(255,255,255,0.05) inset;
    display: flex; flex-direction: column;
    position: fixed; left: 12px; top: 12px; bottom: 12px; z-index: 50;
    transition: transform 0.3s cubic-bezier(0.4,0,0.2,1);
    flex-shrink: 0;
    overflow: hidden;
  }
  .sidebar-logo {
    padding: 22px 18px 18px;
    border-bottom: 1px solid rgba(255,255,255,0.07);
    display: flex; align-items: center; gap: 12px;
  }
  .logo-icon {
    width: 36px; height: 36px; border-radius: 10px;
    background: linear-gradient(135deg, var(--red), #c0392b);
    display: flex; align-items: center; justify-content: center;
    font-size: 18px; flex-shrink: 0;
    box-shadow: 0 4px 12px var(--red-glow);
  }
  .logo-text { font-family: 'Sora', sans-serif; font-size: 13px; font-weight: 700; line-height: 1.3; }
  .logo-sub { font-size: 10px; color: var(--text-secondary); font-weight: 400; }

  .sidebar-nav { flex: 1; padding: 16px 12px; display: flex; flex-direction: column; gap: 4px; overflow-y: auto; }
  .nav-section-label {
    font-size: 10px; font-weight: 600; color: var(--text-tertiary);
    letter-spacing: 1px; text-transform: uppercase;
    padding: 12px 8px 6px; margin-top: 4px;
  }
  .nav-item {
    display: flex; align-items: center; gap: 11px;
    padding: 10px 12px; border-radius: 12px;
    cursor: pointer; transition: all 0.2s ease;
    color: var(--text-secondary); font-size: 14px; font-weight: 500;
    border: 1px solid transparent;
    position: relative;
  }
  .nav-item:hover { color: white; background: rgba(255,255,255,0.06); }
  .nav-item.active {
    color: white;
    background: rgba(230,57,70,0.12);
    border-color: rgba(230,57,70,0.2);
  }
  .nav-item.active::before {
    content: '';
    position: absolute; left: 0; top: 20%; bottom: 20%;
    width: 3px; border-radius: 0 2px 2px 0;
    background: var(--red);
    box-shadow: 0 0 8px var(--red-glow);
  }
  .nav-icon { font-size: 17px; width: 20px; text-align: center; flex-shrink: 0; }
  .nav-badge {
    margin-left: auto;
    background: var(--red); color: white;
    font-size: 10px; font-weight: 700;
    padding: 1px 6px; border-radius: 20px;
    min-width: 18px; text-align: center;
  }
  .sidebar-user {
    padding: 14px 16px 18px;
    border-top: 1px solid rgba(255,255,255,0.07);
    display: flex; align-items: center; gap: 10px;
  }
  .user-avatar {
    width: 36px; height: 36px; border-radius: 50%;
    background: linear-gradient(135deg, var(--red), var(--gold));
    display: flex; align-items: center; justify-content: center;
    font-size: 14px; font-weight: 700; flex-shrink: 0;
  }
  .user-name { font-size: 13px; font-weight: 600; }
  .user-role { font-size: 11px; color: var(--text-secondary); }
  .logout-btn {
    margin-left: auto; background: none; border: none;
    color: var(--text-tertiary); cursor: pointer; font-size: 18px;
    transition: color 0.2s; padding: 4px;
  }
  .logout-btn:hover { color: var(--red); }

  /* ‚îÄ‚îÄ MAIN CONTENT ‚îÄ‚îÄ */
  .main-content {
    flex: 1;
    margin-left: calc(var(--sidebar-w) + 24px);
    min-height: 100vh;
    display: flex; flex-direction: column;
    overflow-y: auto;
    position: relative;
  }
  .topbar {
    position: sticky; top: 0; z-index: 30;
    background: rgba(8,8,16,0.8);
    backdrop-filter: blur(20px);
    border-bottom: 1px solid var(--glass-border);
    padding: 16px 28px;
    display: flex; align-items: center; justify-content: space-between;
  }
  .topbar-title { font-family: 'Sora', sans-serif; font-size: 20px; font-weight: 700; }
  .topbar-time { font-family: 'JetBrains Mono', monospace; font-size: 12px; color: var(--text-secondary); }
  .content-area { padding: 28px; flex: 1; }

  /* ‚îÄ‚îÄ PAGE SECTIONS ‚îÄ‚îÄ */
  .page { display: none; animation: fade-up 0.35s ease; }
  .page.active { display: block; }

  /* ‚îÄ‚îÄ STAT CARDS ‚îÄ‚îÄ */
  .stats-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 16px; margin-bottom: 24px; }
  .stat-card {
    padding: 20px;
    background: var(--glass);
    backdrop-filter: blur(20px);
    border: 1px solid var(--glass-border);
    border-radius: var(--radius);
    box-shadow: 0 4px 20px rgba(0,0,0,0.3);
    animation: fade-up 0.4s ease both;
  }
  .stat-label { font-size: 11px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.8px; margin-bottom: 8px; }
  .stat-value { font-family: 'Sora', sans-serif; font-size: 32px; font-weight: 800; line-height: 1; }
  .stat-sub { font-size: 12px; color: var(--text-secondary); margin-top: 4px; }
  .stat-card:nth-child(1) { animation-delay: 0.05s; }
  .stat-card:nth-child(2) { animation-delay: 0.1s; }
  .stat-card:nth-child(3) { animation-delay: 0.15s; }
  .stat-card:nth-child(4) { animation-delay: 0.2s; }

  /* ‚îÄ‚îÄ SECTION HEADERS ‚îÄ‚îÄ */
  .section-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px; }
  .section-title { font-family: 'Sora', sans-serif; font-size: 15px; font-weight: 700; }
  .section-action { font-size: 12px; color: var(--red); cursor: pointer; font-weight: 500; }

  /* ‚îÄ‚îÄ APPARATUS GRID ‚îÄ‚îÄ */
  .apparatus-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 16px; margin-bottom: 28px; }
  .apparatus-card {
    padding: 20px;
    background: var(--glass);
    backdrop-filter: blur(20px);
    border: 1px solid var(--glass-border);
    border-radius: var(--radius);
    cursor: pointer; position: relative; overflow: hidden;
    transition: all 0.25s ease;
    animation: fade-up 0.4s ease both;
  }
  .apparatus-card::after {
    content: '';
    position: absolute; inset: 0;
    background: linear-gradient(135deg, rgba(255,255,255,0.02) 0%, transparent 60%);
    pointer-events: none;
  }
  .apparatus-card:hover { transform: translateY(-4px) scale(1.01); box-shadow: 0 16px 48px rgba(0,0,0,0.5); border-color: rgba(255,255,255,0.14); }
  .apparatus-icon { font-size: 28px; margin-bottom: 12px; }
  .apparatus-name { font-family: 'Sora', sans-serif; font-size: 16px; font-weight: 700; margin-bottom: 3px; }
  .apparatus-type { font-size: 12px; color: var(--text-secondary); margin-bottom: 14px; }
  .apparatus-status { display: flex; align-items: center; gap: 8px; }
  .apparatus-status-text { font-size: 12px; font-weight: 600; }
  .apparatus-status-text.green { color: var(--green); }
  .apparatus-status-text.red { color: var(--red); }
  .apparatus-status-text.amber { color: var(--amber); }

  /* ‚îÄ‚îÄ TWO-COL LAYOUT ‚îÄ‚îÄ */
  .two-col { display: grid; grid-template-columns: 1fr 320px; gap: 20px; }

  /* ‚îÄ‚îÄ WEBSITE STATUS CARD ‚îÄ‚îÄ */
  .status-list { display: flex; flex-direction: column; gap: 12px; padding: 20px; }
  .status-row { display: flex; align-items: center; gap: 10px; }
  .status-row-label { flex: 1; font-size: 13px; font-weight: 500; }
  .status-row-url { font-size: 11px; color: var(--text-tertiary); font-family: 'JetBrains Mono', monospace; }
  .status-link { cursor: pointer; color: var(--blue); font-size: 14px; }
  .status-link:hover { opacity: 0.7; }

  /* ‚îÄ‚îÄ ACTIVITY FEED ‚îÄ‚îÄ */
  .activity-feed { display: flex; flex-direction: column; gap: 2px; }
  .activity-item {
    display: flex; align-items: center; gap: 12px;
    padding: 12px 16px; border-radius: 12px;
    transition: background 0.2s;
  }
  .activity-item:hover { background: rgba(255,255,255,0.04); }
  .activity-icon { width: 34px; height: 34px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 16px; flex-shrink: 0; }
  .activity-text { flex: 1; }
  .activity-title { font-size: 13px; font-weight: 500; }
  .activity-time { font-size: 11px; color: var(--text-tertiary); font-family: 'JetBrains Mono', monospace; }
  .activity-badge { font-size: 11px; padding: 3px 8px; border-radius: 20px; font-weight: 600; }

  /* ‚îÄ‚îÄ FORM PAGES ‚îÄ‚îÄ */
  .form-page-header {
    padding: 24px 24px 0;
    display: flex; align-items: center; gap: 16px; margin-bottom: 20px;
  }
  .form-page-icon {
    width: 52px; height: 52px; border-radius: 16px;
    display: flex; align-items: center; justify-content: center; font-size: 26px;
    flex-shrink: 0;
  }
  .form-tabs { display: flex; gap: 4px; padding: 4px; background: rgba(255,255,255,0.05); border-radius: 12px; margin-bottom: 20px; }
  .form-tab {
    flex: 1; padding: 9px; border-radius: 9px; border: none;
    background: transparent; color: var(--text-secondary);
    font-family: 'DM Sans', sans-serif; font-size: 13px; font-weight: 500;
    cursor: pointer; transition: all 0.2s;
  }
  .form-tab.active { background: rgba(255,255,255,0.1); color: white; box-shadow: 0 2px 8px rgba(0,0,0,0.3); }
  .form-embed-wrap {
    background: var(--glass);
    backdrop-filter: blur(20px);
    border: 1px solid var(--glass-border);
    border-radius: var(--radius);
    overflow: hidden; height: 680px; position: relative;
  }
  .form-placeholder {
    height: 100%; display: flex; flex-direction: column;
    align-items: center; justify-content: center; gap: 16px;
    color: var(--text-secondary); text-align: center; padding: 40px;
  }
  .form-placeholder-icon { font-size: 56px; opacity: 0.4; }
  .form-placeholder-title { font-family: 'Sora', sans-serif; font-size: 18px; font-weight: 700; color: var(--text-primary); }
  .form-placeholder-text { font-size: 13px; line-height: 1.6; max-width: 320px; }
  .form-url-input {
    width: 100%; max-width: 400px; padding: 10px 14px;
    background: rgba(255,255,255,0.08); border: 1px solid var(--glass-border);
    border-radius: 10px; color: white;
    font-family: 'JetBrains Mono', monospace; font-size: 12px;
    outline: none; text-align: center;
  }
  .form-url-input:focus { border-color: rgba(230,57,70,0.4); }
  .form-url-btn {
    padding: 10px 20px; background: linear-gradient(135deg, var(--red), #c0392b);
    border: none; border-radius: 10px; color: white;
    font-family: 'Sora', sans-serif; font-size: 13px; font-weight: 600;
    cursor: pointer; transition: all 0.2s;
    box-shadow: 0 4px 14px var(--red-glow);
  }
  .form-url-btn:hover { transform: translateY(-1px); }

  /* ‚îÄ‚îÄ ADMIN ‚îÄ‚îÄ */
  .admin-tabs { display: flex; gap: 4px; padding: 4px; background: rgba(255,255,255,0.05); border-radius: 12px; margin-bottom: 24px; flex-wrap: wrap; }
  .admin-tab {
    padding: 9px 16px; border-radius: 9px; border: none;
    background: transparent; color: var(--text-secondary);
    font-family: 'DM Sans', sans-serif; font-size: 13px; font-weight: 500;
    cursor: pointer; transition: all 0.2s; display: flex; align-items: center; gap: 6px;
  }
  .admin-tab.active { background: rgba(255,255,255,0.1); color: white; }
  .admin-section { display: none; }
  .admin-section.active { display: block; animation: fade-up 0.3s ease; }

  .table-wrap {
    background: var(--glass);
    backdrop-filter: blur(20px);
    border: 1px solid var(--glass-border);
    border-radius: var(--radius); overflow: hidden;
  }
  table { width: 100%; border-collapse: collapse; }
  th {
    padding: 12px 16px; text-align: left;
    font-size: 11px; font-weight: 600; color: var(--text-secondary);
    text-transform: uppercase; letter-spacing: 0.8px;
    border-bottom: 1px solid var(--glass-border);
    background: rgba(255,255,255,0.02);
  }
  td { padding: 14px 16px; font-size: 13px; border-bottom: 1px solid rgba(255,255,255,0.04); }
  tr:last-child td { border-bottom: none; }
  tr:hover td { background: rgba(255,255,255,0.03); }

  .badge {
    display: inline-flex; align-items: center; gap: 5px;
    padding: 4px 10px; border-radius: 20px; font-size: 11px; font-weight: 600;
  }
  .badge.green { background: rgba(46,204,113,0.15); color: var(--green); border: 1px solid rgba(46,204,113,0.2); }
  .badge.red { background: rgba(230,57,70,0.15); color: var(--red); border: 1px solid rgba(230,57,70,0.2); }
  .badge.amber { background: rgba(243,156,18,0.15); color: var(--amber); border: 1px solid rgba(243,156,18,0.2); }
  .badge.blue { background: rgba(74,158,255,0.15); color: var(--blue); border: 1px solid rgba(74,158,255,0.2); }

  .action-btn {
    padding: 6px 12px; border-radius: 8px; border: none;
    font-family: 'DM Sans', sans-serif; font-size: 12px; font-weight: 600;
    cursor: pointer; transition: all 0.15s;
  }
  .action-btn.approve { background: rgba(46,204,113,0.15); color: var(--green); }
  .action-btn.deny { background: rgba(230,57,70,0.15); color: var(--red); }
  .action-btn.edit { background: rgba(74,158,255,0.15); color: var(--blue); }
  .action-btn:hover { transform: scale(1.05); }

  /* Status selector */
  .status-select {
    padding: 6px 10px; background: rgba(255,255,255,0.06);
    border: 1px solid var(--glass-border); border-radius: 8px;
    color: white; font-family: 'DM Sans', sans-serif; font-size: 12px;
    outline: none; cursor: pointer;
  }
  .status-select option { background: #1a1a2e; }

  /* ‚îÄ‚îÄ SETTINGS ‚îÄ‚îÄ */
  .settings-section { background: var(--glass); backdrop-filter: blur(20px); border: 1px solid var(--glass-border); border-radius: var(--radius); padding: 24px; margin-bottom: 20px; }
  .settings-title { font-family: 'Sora', sans-serif; font-size: 15px; font-weight: 700; margin-bottom: 4px; }
  .settings-sub { font-size: 13px; color: var(--text-secondary); margin-bottom: 20px; }
  .settings-row { display: flex; align-items: center; justify-content: space-between; padding: 14px 0; border-bottom: 1px solid rgba(255,255,255,0.05); }
  .settings-row:last-child { border-bottom: none; padding-bottom: 0; }
  .settings-row-left { flex: 1; }
  .settings-row-label { font-size: 14px; font-weight: 500; }
  .settings-row-sub { font-size: 12px; color: var(--text-secondary); margin-top: 2px; }

  /* iOS Toggle */
  .toggle { position: relative; width: 50px; height: 28px; flex-shrink: 0; }
  .toggle input { opacity: 0; width: 0; height: 0; }
  .toggle-slider {
    position: absolute; inset: 0;
    background: rgba(255,255,255,0.15); border-radius: 28px;
    cursor: pointer; transition: all 0.3s;
    border: 1px solid rgba(255,255,255,0.1);
  }
  .toggle-slider::before {
    content: ''; position: absolute;
    left: 3px; top: 50%; transform: translateY(-50%);
    width: 22px; height: 22px; border-radius: 50%;
    background: white; transition: all 0.3s cubic-bezier(0.34,1.56,0.64,1);
    box-shadow: 0 2px 6px rgba(0,0,0,0.3);
  }
  .toggle input:checked + .toggle-slider { background: var(--green); border-color: var(--green); box-shadow: 0 0 14px rgba(46,204,113,0.4); }
  .toggle input:checked + .toggle-slider::before { left: calc(100% - 25px); }

  /* Profile pic area */
  .profile-pic-area { display: flex; align-items: center; gap: 16px; margin-bottom: 20px; }
  .profile-pic {
    width: 72px; height: 72px; border-radius: 50%;
    background: linear-gradient(135deg, var(--red), var(--gold));
    display: flex; align-items: center; justify-content: center;
    font-size: 28px; font-weight: 700; cursor: pointer;
    border: 2px solid rgba(255,255,255,0.1); transition: all 0.2s;
  }
  .profile-pic:hover { transform: scale(1.04); border-color: rgba(230,57,70,0.4); }

  /* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
  .toast-container { position: fixed; top: 20px; right: 20px; z-index: 500; display: flex; flex-direction: column; gap: 10px; }
  .toast {
    padding: 14px 18px;
    background: rgba(15,15,25,0.95);
    backdrop-filter: blur(30px);
    border: 1px solid var(--glass-border);
    border-radius: 14px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.5);
    display: flex; align-items: center; gap: 10px;
    font-size: 13px; font-weight: 500; min-width: 260px;
    animation: toast-in 0.35s cubic-bezier(0.34,1.56,0.64,1);
  }
  .toast.success { border-left: 3px solid var(--green); }
  .toast.error { border-left: 3px solid var(--red); }
  .toast.info { border-left: 3px solid var(--blue); }
  .toast-icon { font-size: 18px; }

  /* ‚îÄ‚îÄ ANNOUNCEMENT BANNER ‚îÄ‚îÄ */
  .announcement {
    background: linear-gradient(135deg, rgba(244,162,97,0.12), rgba(230,57,70,0.08));
    border: 1px solid rgba(244,162,97,0.2);
    border-radius: var(--radius);
    padding: 16px 20px;
    display: flex; align-items: flex-start; gap: 12px;
    margin-bottom: 24px;
    animation: fade-up 0.4s ease;
  }
  .announcement-icon { font-size: 20px; margin-top: 1px; }
  .announcement-title { font-size: 13px; font-weight: 700; color: var(--gold); margin-bottom: 3px; }
  .announcement-body { font-size: 13px; color: rgba(255,255,255,0.7); line-height: 1.5; }

  /* ‚îÄ‚îÄ BOTTOM NAV (mobile) ‚îÄ‚îÄ */
  .bottom-nav {
    display: none; position: fixed;
    bottom: 14px; left: 50%; transform: translateX(-50%);
    width: auto; min-width: 300px;
    z-index: 50;
    background: rgba(10,10,20,0.78);
    backdrop-filter: blur(48px) saturate(200%);
    -webkit-backdrop-filter: blur(48px) saturate(200%);
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 26px;
    box-shadow: 0 8px 40px rgba(0,0,0,0.6), 0 0 0 0.5px rgba(255,255,255,0.05) inset;
    padding: 8px 12px;
    justify-content: space-around;
    gap: 4px;
  }
  .bottom-nav-item {
    display: flex; flex-direction: column; align-items: center; gap: 3px;
    padding: 7px 14px; border-radius: 18px; cursor: pointer;
    color: var(--text-tertiary); transition: all 0.2s; flex: 1;
  }
  .bottom-nav-item.active {
    color: var(--red);
    background: rgba(230,57,70,0.12);
  }
  .bottom-nav-icon { font-size: 20px; }
  .bottom-nav-label { font-size: 9px; font-weight: 600; letter-spacing: 0.3px; }

  /* ‚îÄ‚îÄ MOBILE SIDEBAR TOGGLE ‚îÄ‚îÄ */
  .menu-toggle {
    display: none; background: none; border: none;
    color: white; font-size: 22px; cursor: pointer; padding: 4px;
  }
  .sidebar-overlay { display: none; position: fixed; inset: 0; z-index: 49; background: rgba(0,0,0,0.6); backdrop-filter: blur(4px); }

  /* ‚îÄ‚îÄ EMPTY STATE ‚îÄ‚îÄ */
  .empty-state { text-align: center; padding: 60px 20px; color: var(--text-secondary); }
  .empty-icon { font-size: 52px; opacity: 0.3; margin-bottom: 16px; }
  .empty-title { font-family: 'Sora', sans-serif; font-size: 16px; font-weight: 700; color: var(--text-primary); margin-bottom: 6px; }
  .empty-text { font-size: 13px; line-height: 1.6; }

  /* ‚îÄ‚îÄ RESPONSIVE ‚îÄ‚îÄ */
  @media (max-width: 900px) {
    .two-col { grid-template-columns: 1fr; }
  }
  @media (max-width: 768px) {
    .sidebar { transform: translateX(calc(-100% - 16px)); }
    .sidebar.open { transform: translateX(0); }
    .sidebar-overlay.open { display: block; }
    .main-content { margin-left: 0; padding-bottom: 80px; }
    .bottom-nav { display: flex; }
    .menu-toggle { display: block; }
    .content-area { padding: 20px 16px; }
    .stats-row { grid-template-columns: repeat(2, 1fr); }
    .topbar { padding: 14px 16px; }
  }
  @media (max-width: 480px) {
    .apparatus-grid { grid-template-columns: repeat(2, 1fr); }
    .admin-tabs { gap: 2px; }
    .admin-tab { padding: 8px 10px; font-size: 12px; }
  }

  /* ‚îÄ‚îÄ MISC UTILS ‚îÄ‚îÄ */
  .divider { height: 1px; background: var(--glass-border); margin: 20px 0; }
  .text-red { color: var(--red); }
  .text-gold { color: var(--gold); }
  .text-green { color: var(--green); }
  .text-secondary { color: var(--text-secondary); }
  .mt-4 { margin-top: 4px; }
  .mb-20 { margin-bottom: 20px; }
  .flex-center { display: flex; align-items: center; }
  .gap-8 { gap: 8px; }
  .gap-12 { gap: 12px; }
  input[type="range"] { accent-color: var(--red); width: 100%; }

  /* ‚îÄ‚îÄ FIREBASE NATIVE FORMS ‚îÄ‚îÄ */
  .fb-form { padding: 4px 0 20px; }
  .fb-form .field textarea {
    width: 100%; padding: 12px 14px;
    background: rgba(255,255,255,0.06);
    border: 1px solid var(--glass-border);
    border-radius: 10px; color: white;
    font-family: 'DM Sans', sans-serif; font-size: 14px;
    outline: none; resize: vertical; min-height: 90px; line-height: 1.6;
    transition: border-color 0.2s;
  }
  .fb-form .field textarea:focus { border-color: rgba(230,57,70,0.5); }
  .fb-form .field textarea::placeholder { color: var(--text-tertiary); }
  .form-grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 0 16px; }
  @media (max-width: 600px) { .form-grid-2 { grid-template-columns: 1fr; } }
  .checkbox-group { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 6px; }
  .checkbox-label {
    display: flex; align-items: center; gap: 7px;
    padding: 7px 12px;
    background: rgba(255,255,255,0.05);
    border: 1px solid var(--glass-border);
    border-radius: 8px; cursor: pointer;
    font-size: 13px; color: var(--text-secondary);
    transition: all 0.15s; user-select: none;
  }
  .checkbox-label:hover { background: rgba(255,255,255,0.09); color: white; }
  .checkbox-label input[type="checkbox"] { accent-color: var(--red); width: 14px; height: 14px; cursor: pointer; }
  .checkbox-label.checked { background: rgba(230,57,70,0.12); border-color: rgba(230,57,70,0.25); color: white; }
  .result-group { display: flex; gap: 8px; margin-top: 6px; }
  .result-btn {
    flex: 1; padding: 9px 0; border-radius: 8px; border: 1px solid var(--glass-border);
    background: rgba(255,255,255,0.05); color: var(--text-secondary);
    font-family: 'DM Sans', sans-serif; font-size: 13px; font-weight: 500;
    cursor: pointer; transition: all 0.15s; text-align: center;
  }
  .result-btn:hover { background: rgba(255,255,255,0.09); color: white; }
  .result-btn.selected-pass { background: rgba(46,204,113,0.18); border-color: rgba(46,204,113,0.4); color: var(--green); }
  .result-btn.selected-minor { background: rgba(243,156,18,0.18); border-color: rgba(243,156,18,0.4); color: var(--amber); }
  .result-btn.selected-fail { background: rgba(230,57,70,0.18); border-color: rgba(230,57,70,0.4); color: var(--red); }
  .form-submit-row { margin-top: 20px; display: flex; gap: 10px; }
  /* Submissions list */
  .submissions-list { display: flex; flex-direction: column; gap: 12px; padding: 4px 0; }
  .submission-card {
    padding: 16px 20px;
    background: var(--glass);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid var(--glass-border);
    border-radius: var(--radius-sm);
    animation: fade-up 0.3s ease;
  }
  .submission-card-header { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; flex-wrap: wrap; }
  .submission-card-meta { font-size: 11px; color: var(--text-tertiary); font-family: 'JetBrains Mono', monospace; }
  .submission-card-row { display: flex; gap: 8px; font-size: 13px; margin-bottom: 5px; }
  .submission-card-label { color: var(--text-secondary); min-width: 110px; font-size: 11px; text-transform: uppercase; letter-spacing: 0.4px; flex-shrink: 0; }
  .submission-card-value { color: var(--text-primary); }
  .submissions-loading { text-align: center; padding: 40px; color: var(--text-secondary); font-size: 13px; }
  .fb-config-notice {
    display: flex; align-items: center; justify-content: center;
    min-height: 200px; flex-direction: column; gap: 12px;
    color: var(--text-secondary); text-align: center; padding: 40px;
  }
  .fb-config-notice .notice-icon { font-size: 36px; }
  .fb-config-notice .notice-title { font-family: 'Sora', sans-serif; font-size: 16px; font-weight: 600; color: var(--text-primary); }
  .fb-config-notice .notice-text { font-size: 13px; max-width: 300px; line-height: 1.6; }
  /* Admin Firebase tab */
  .config-pre {
    background: rgba(0,0,0,0.4); border: 1px solid var(--glass-border);
    border-radius: 10px; padding: 14px 16px;
    font-family: 'JetBrains Mono', monospace; font-size: 12px;
    color: var(--gold); overflow-x: auto; margin: 10px 0 14px;
    white-space: pre; line-height: 1.6;
  }
  .config-status-row { display: flex; align-items: center; gap: 8px; font-size: 13px; margin: 10px 0 18px; padding: 12px 16px; background: rgba(255,255,255,0.04); border-radius: 10px; border: 1px solid var(--glass-border); }
</style>
</head>
<body>

<div class="bg-mesh"></div>

<!-- TOAST CONTAINER -->
<div class="toast-container" id="toastContainer"></div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<!--  AUTH SCREEN                                   -->
<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="auth-screen">
  <div class="auth-bg"></div>

  <!-- Embers generated by JS -->

  <div class="auth-card glass" id="authCard">
    <div class="dept-badge">üî•</div>
    <div class="auth-title">Colton Volunteer Fire</div>
    <div class="auth-sub">Member Portal ¬∑ Secure Access</div>

    <div style="display:flex;align-items:center;justify-content:center;gap:7px;margin-bottom:20px;">
      <div class="dot green"></div>
      <span style="font-size:12px;color:var(--text-secondary);">System Online</span>
    </div>

    <div class="select-wrap">
      <select id="memberSelect" onchange="onMemberSelect()">
        <option value="">Select your name‚Ä¶</option>
        <option value="dkota_admin">Dkota Wright (Admin)</option>
      </select>
      <span class="select-arrow">‚ñæ</span>
    </div>

    <div id="pin-section">
      <div id="pin-label" style="font-size:12px;color:var(--text-secondary);margin-bottom:8px;text-transform:uppercase;letter-spacing:0.5px;font-weight:500;">Enter your PIN</div>
      <input type="password" id="pinTextInput" maxlength="4" inputmode="numeric" pattern="[0-9]*" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="off"
        style="width:100%;padding:14px;background:rgba(255,255,255,0.07);border:1px solid var(--glass-border);border-radius:12px;color:white;font-family:'JetBrains Mono',monospace;font-size:22px;letter-spacing:8px;text-align:center;outline:none;transition:border-color 0.2s;"
        oninput="onPinTextInput(this)" onkeydown="if(event.key==='Enter')checkPin()">
    </div>

    <button class="btn-ghost" onclick="openModal('requestModal')" style="margin-top:8px;">Not a member? Request Access</button>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<!--  REQUEST ACCESS MODAL                          -->
<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="modal-overlay" id="requestModal">
  <div class="modal">
    <div class="modal-title">Request Access</div>
    <div class="modal-sub">Your request will be reviewed by department administration.</div>
    <div class="field"><label>Full Name</label><input type="text" placeholder="First Last" id="req_name"></div>
    <div class="field"><label>Badge / Member #</label><input type="text" placeholder="e.g. 4412" id="req_badge"></div>
    <div class="field"><label>Email Address</label><input type="email" placeholder="you@example.com" id="req_email"></div>
    <div class="field">
      <label>Rank / Role</label>
      <select id="req_rank" style="background:rgba(255,255,255,0.06);border:1px solid var(--glass-border);border-radius:10px;color:white;padding:12px 14px;width:100%;outline:none;font-family:'DM Sans',sans-serif;font-size:14px;">
        <option value="">Select rank‚Ä¶</option>
        <option>Chief</option><option>Deputy Chief</option><option>Captain</option>
        <option>Lieutenant</option><option>Firefighter</option><option>EMT</option>
        <option>Paramedic</option><option>Probationary FF</option>
      </select>
    </div>
    <div class="modal-actions">
      <button class="btn-sm secondary" onclick="closeModal('requestModal')">Cancel</button>
      <button class="btn-sm primary" onclick="submitRequest()">Submit Request</button>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<!--  MAIN APP                                      -->
<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="app">
  <!-- Sidebar overlay (mobile) -->
  <div class="sidebar-overlay" id="sidebarOverlay" onclick="closeSidebar()"></div>

  <!-- SIDEBAR -->
  <nav class="sidebar" id="sidebar">
    <div class="sidebar-logo">
      <div class="logo-icon">üî•</div>
      <div class="logo-text">
        Colton VFD
        <div class="logo-sub">Member Portal</div>
      </div>
    </div>

    <div class="sidebar-nav">
      <div class="nav-section-label">Main</div>
      <div class="nav-item active" onclick="navigate('dashboard',this)">
        <span class="nav-icon">üè†</span> Dashboard
      </div>

      <div class="nav-section-label">Operations</div>
      <div class="nav-item" onclick="navigate('callogs',this)">
        <span class="nav-icon">üìã</span> Call Run Logs
      </div>
      <div class="nav-item" onclick="navigate('rescue',this)">
        <span class="nav-icon">üöë</span> Rescue Checks
      </div>
      <div class="nav-item" onclick="navigate('trucks',this)">
        <span class="nav-icon">üöí</span> Truck Checks
      </div>

      <div class="nav-section-label">Account</div>
      <div class="nav-item" onclick="navigate('settings',this)">
        <span class="nav-icon">‚öôÔ∏è</span> Settings
      </div>
      <div class="nav-item" id="adminNavItem" onclick="navigate('admin',this)">
        <span class="nav-icon">üõ°Ô∏è</span> Admin
        <span class="nav-badge" id="adminBadge">3</span>
      </div>
    </div>

    <div class="sidebar-user">
      <div class="user-avatar" id="sidebarAvatar">D</div>
      <div>
        <div class="user-name" id="sidebarName">Dkota</div>
        <div class="user-role" id="sidebarRole">Administrator</div>
      </div>
      <button class="logout-btn" onclick="logout()" title="Sign Out">‚èª</button>
    </div>
  </nav>

  <!-- MAIN CONTENT -->
  <div class="main-content">
    <!-- Top bar -->
    <div class="topbar">
      <div style="display:flex;align-items:center;gap:12px;">
        <button class="menu-toggle" onclick="toggleSidebar()">‚ò∞</button>
        <div class="topbar-title" id="topbarTitle">Dashboard</div>
      </div>
      <div class="topbar-time" id="liveClock"></div>
    </div>

    <div class="content-area">

      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê DASHBOARD ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <div class="page active" id="page-dashboard">

        <div class="announcement" id="announcementBanner">
          <div class="announcement-icon">üì¢</div>
          <div>
            <div class="announcement-title">Department Announcement</div>
            <div class="announcement-body" id="announcementText">Training drill this Saturday at 0800. All members required to attend. Contact Chief Harmon for any scheduling conflicts.</div>
          </div>
        </div>

        <div class="stats-row">
          <div class="stat-card">
            <div class="stat-label">Calls This Month</div>
            <div class="stat-value text-red">24</div>
            <div class="stat-sub">‚Üë 4 from last month</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Active Members</div>
            <div class="stat-value">18</div>
            <div class="stat-sub">2 online now</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Calls YTD</div>
            <div class="stat-value text-gold">186</div>
            <div class="stat-sub">Since Jan 1</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Pending Requests</div>
            <div class="stat-value text-amber" id="dashPendingCount">3</div>
            <div class="stat-sub" style="cursor:pointer;color:var(--red);" onclick="navigate('admin',document.querySelector('[onclick*=admin]'))">Review ‚Üí</div>
          </div>
        </div>

        <!-- Apparatus Grid -->
        <div class="section-header">
          <div class="section-title">üöí Apparatus Status</div>
          <div class="section-action" onclick="navigate('admin',document.getElementById('adminNavItem'));switchAdminTab('apparatus')">Manage ‚Üí</div>
        </div>
        <div class="apparatus-grid" id="apparatusGrid"></div>

        <!-- Two column: Website status + Activity -->
        <div class="two-col">
          <div>
            <div class="section-header mb-20">
              <div class="section-title">üì° Recent Activity</div>
            </div>
            <div class="glass" style="overflow:hidden;">
              <div class="activity-feed" id="activityFeed"></div>
            </div>
          </div>
          <div>
            <div class="section-header mb-20">
              <div class="section-title">üåê Live Status</div>
            </div>
            <div class="glass status-list" id="siteStatusList"></div>
          </div>
        </div>
      </div>

      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CALL LOGS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <div class="page" id="page-callogs">
        <div class="stats-row">
          <div class="stat-card"><div class="stat-label">Total YTD</div><div class="stat-value text-red">186</div><div class="stat-sub">All incidents</div></div>
          <div class="stat-card"><div class="stat-label">This Month</div><div class="stat-value">24</div><div class="stat-sub">February 2026</div></div>
          <div class="stat-card"><div class="stat-label">Last Call</div><div class="stat-value" style="font-size:22px;">Feb 16</div><div class="stat-sub">Structure Fire ¬∑ 14:32</div></div>
        </div>
        <div class="form-tabs">
          <button class="form-tab active" onclick="switchFormTab(this,'calllog-submit')">üìù Submit Log</button>
          <button class="form-tab" onclick="switchFormTab(this,'calllog-history')">üìÇ View History</button>
        </div>
        <div id="calllog-submit">
          <div class="fb-config-notice" id="cl-config-notice" style="display:none;">
            <div class="notice-icon">üî•</div>
            <div class="notice-title">Firebase Not Configured</div>
            <div class="notice-text">Go to Admin ‚Üí Firebase tab for setup instructions.</div>
          </div>
          <div class="fb-form" id="cl-form-wrap">
            <div class="form-grid-2">
              <div class="field"><label>Date &amp; Time</label><input type="datetime-local" id="cl_datetime"></div>
              <div class="field"><label>Incident Number</label><input type="text" id="cl_incident_num" placeholder="e.g. 2026-0217-001"></div>
            </div>
            <div class="field">
              <label>Incident Type</label>
              <select id="cl_type">
                <option value="">Select type‚Ä¶</option>
                <option>Structure Fire</option>
                <option>Vehicle Accident</option>
                <option>Medical</option>
                <option>Brush Fire</option>
                <option>HazMat</option>
                <option>Other</option>
              </select>
            </div>
            <div class="field"><label>Address / Location</label><input type="text" id="cl_address" placeholder="123 Main St, Colton"></div>
            <div class="field">
              <label>Units Responding</label>
              <div class="checkbox-group" id="cl_units_group">
                <label class="checkbox-label"><input type="checkbox" value="Engine 411"> Engine 411</label>
                <label class="checkbox-label"><input type="checkbox" value="Rescue 412"> Rescue 412</label>
                <label class="checkbox-label"><input type="checkbox" value="Tanker 413"> Tanker 413</label>
                <label class="checkbox-label"><input type="checkbox" value="Brush 414"> Brush 414</label>
                <label class="checkbox-label"><input type="checkbox" value="Command 415"> Command 415</label>
                <label class="checkbox-label"><input type="checkbox" value="Utility 416"> Utility 416</label>
              </div>
            </div>
            <div class="field">
              <label>Personnel on Scene</label>
              <div class="checkbox-group" id="cl_personnel_group">
                <div style="color:var(--text-tertiary);font-size:13px;padding:8px 0;">Loading roster‚Ä¶</div>
              </div>
            </div>
            <div class="field">
              <label>Mutual Aid</label>
              <div style="display:flex;align-items:center;gap:12px;padding:10px 0;">
                <span style="font-size:13px;color:var(--text-secondary);">Mutual aid requested/provided?</span>
                <label class="toggle"><input type="checkbox" id="cl_mutual_aid"><span class="toggle-slider"></span></label>
              </div>
            </div>
            <div class="field"><label>Outcome / Notes</label><textarea id="cl_notes" placeholder="Describe the outcome, actions taken, any notable events‚Ä¶"></textarea></div>
            <div class="field"><label>Submitted By</label><input type="text" id="cl_submitted_by" readonly style="opacity:0.6;cursor:not-allowed;"></div>
            <div class="form-submit-row">
              <button class="btn-sm primary" style="max-width:180px;" onclick="submitCallLog()">üìã Submit Log</button>
              <button class="btn-sm" style="background:rgba(255,255,255,0.07);border:1px solid var(--glass-border);color:var(--text-secondary);padding:10px 18px;border-radius:10px;cursor:pointer;font-family:'DM Sans',sans-serif;font-size:13px;" onclick="resetCallLogForm()">Clear</button>
            </div>
          </div>
        </div>
        <div id="calllog-history" style="display:none;">
          <div class="submissions-list" id="calllog-submissions-list">
            <div class="submissions-loading">Loading‚Ä¶</div>
          </div>
        </div>
      </div>

      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê RESCUE CHECKS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <div class="page" id="page-rescue">
        <div style="display:flex;align-items:center;gap:16px;margin-bottom:24px;">
          <div style="width:52px;height:52px;border-radius:16px;background:linear-gradient(135deg,#F4A261,#E07B39);display:flex;align-items:center;justify-content:center;font-size:26px;box-shadow:0 4px 16px rgba(244,162,97,0.35);">üöë</div>
          <div>
            <div style="font-family:'Sora',sans-serif;font-size:18px;font-weight:700;">Rescue Squad Checks</div>
            <div style="font-size:13px;color:var(--text-secondary);">Daily & weekly apparatus inspection forms</div>
          </div>
        </div>
        <div class="stats-row">
          <div class="stat-card"><div class="stat-label">Last Check</div><div class="stat-value" style="font-size:20px;">Today</div><div class="stat-sub">07:30 ¬∑ EMT Wolfe</div></div>
          <div class="stat-card"><div class="stat-label">This Week</div><div class="stat-value text-gold">7</div><div class="stat-sub">Checks completed</div></div>
          <div class="stat-card"><div class="stat-label">Status</div><div class="stat-value" style="font-size:20px;color:var(--green);">‚úì Clear</div><div class="stat-sub">No deficiencies</div></div>
        </div>
        <div class="form-tabs">
          <button class="form-tab active" onclick="switchFormTab(this,'rescue-submit')">üìù Submit Check</button>
          <button class="form-tab" onclick="switchFormTab(this,'rescue-history')">üìÇ History</button>
        </div>
        <div id="rescue-submit">
          <div class="fb-config-notice" id="rs-config-notice" style="display:none;">
            <div class="notice-icon">üöë</div>
            <div class="notice-title">Firebase Not Configured</div>
            <div class="notice-text">Go to Admin ‚Üí Firebase tab for setup instructions.</div>
          </div>
          <div class="fb-form" id="rs-form-wrap">
            <div class="form-grid-2">
              <div class="field"><label>Check Date</label><input type="date" id="rs_date"></div>
              <div class="field">
                <label>Check Type</label>
                <select id="rs_check_type">
                  <option value="Daily">Daily</option>
                  <option value="Weekly">Weekly</option>
                </select>
              </div>
            </div>
            <div class="field"><label>Unit</label><input type="text" id="rs_unit" value="Rescue 412" readonly style="opacity:0.6;cursor:not-allowed;"></div>
            <div class="field"><label>O2 Level (%)</label><input type="number" id="rs_o2" min="0" max="100" placeholder="95"></div>
            <div class="field">
              <label>Equipment Check</label>
              <div class="checkbox-group" id="rs_equip_group">
                <label class="checkbox-label"><input type="checkbox" value="AED"> AED</label>
                <label class="checkbox-label"><input type="checkbox" value="Backboard"> Backboard</label>
                <label class="checkbox-label"><input type="checkbox" value="O2 Kit"> O2 Kit</label>
                <label class="checkbox-label"><input type="checkbox" value="Suction"> Suction</label>
                <label class="checkbox-label"><input type="checkbox" value="Splints"> Splints</label>
                <label class="checkbox-label"><input type="checkbox" value="Trauma Bag"> Trauma Bag</label>
              </div>
            </div>
            <div class="field"><label>Deficiencies / Notes</label><textarea id="rs_deficiencies" placeholder="List any deficiencies found, or leave blank if none‚Ä¶"></textarea></div>
            <div class="field">
              <label>Result</label>
              <div class="result-group">
                <button class="result-btn" id="rs_pass" onclick="selectResult('rs','Pass')">‚úì Pass</button>
                <button class="result-btn" id="rs_minor" onclick="selectResult('rs','Minor')">‚ö† Minor</button>
                <button class="result-btn" id="rs_fail" onclick="selectResult('rs','Fail')">‚úï Fail</button>
              </div>
            </div>
            <div class="field"><label>Submitted By</label><input type="text" id="rs_submitted_by" readonly style="opacity:0.6;cursor:not-allowed;"></div>
            <div class="form-submit-row">
              <button class="btn-sm primary" style="max-width:200px;background:linear-gradient(135deg,#F4A261,#E07B39);box-shadow:0 4px 14px rgba(244,162,97,0.35);" onclick="submitRescueCheck()">üöë Submit Check</button>
              <button class="btn-sm" style="background:rgba(255,255,255,0.07);border:1px solid var(--glass-border);color:var(--text-secondary);padding:10px 18px;border-radius:10px;cursor:pointer;font-family:'DM Sans',sans-serif;font-size:13px;" onclick="resetRescueForm()">Clear</button>
            </div>
          </div>
        </div>
        <div id="rescue-history" style="display:none;">
          <div class="submissions-list" id="rescue-submissions-list">
            <div class="submissions-loading">Loading‚Ä¶</div>
          </div>
        </div>
      </div>

      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TRUCK CHECKS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <div class="page" id="page-trucks">
        <div style="display:flex;align-items:center;gap:16px;margin-bottom:24px;">
          <div style="width:52px;height:52px;border-radius:16px;background:linear-gradient(135deg,var(--red),#c0392b);display:flex;align-items:center;justify-content:center;font-size:26px;box-shadow:0 4px 16px var(--red-glow);">üöí</div>
          <div>
            <div style="font-family:'Sora',sans-serif;font-size:18px;font-weight:700;">Fire Apparatus Checks</div>
            <div style="font-size:13px;color:var(--text-secondary);">Engine, tanker, and aerial inspection forms</div>
          </div>
        </div>
        <div class="stats-row">
          <div class="stat-card"><div class="stat-label">Last Check</div><div class="stat-value" style="font-size:20px;">Feb 16</div><div class="stat-sub">08:00 ¬∑ FF Torres</div></div>
          <div class="stat-card"><div class="stat-label">This Week</div><div class="stat-value text-red">5</div><div class="stat-sub">Checks completed</div></div>
          <div class="stat-card"><div class="stat-label">Engine 411</div><div class="stat-value" style="font-size:20px;color:var(--green);">‚úì OK</div><div class="stat-sub">No deficiencies</div></div>
        </div>
        <div class="form-tabs">
          <button class="form-tab active" onclick="switchFormTab(this,'truck-submit')">üìù Submit Check</button>
          <button class="form-tab" onclick="switchFormTab(this,'truck-history')">üìÇ History</button>
        </div>
        <div id="truck-submit">
          <div class="fb-config-notice" id="tc-config-notice" style="display:none;">
            <div class="notice-icon">üöí</div>
            <div class="notice-title">Firebase Not Configured</div>
            <div class="notice-text">Go to Admin ‚Üí Firebase tab for setup instructions.</div>
          </div>
          <div class="fb-form" id="tc-form-wrap">
            <div class="form-grid-2">
              <div class="field"><label>Check Date</label><input type="date" id="tc_date"></div>
              <div class="field">
                <label>Check Type</label>
                <select id="tc_check_type">
                  <option value="Daily">Daily</option>
                  <option value="Weekly">Weekly</option>
                </select>
              </div>
            </div>
            <div class="field">
              <label>Unit</label>
              <select id="tc_unit">
                <option value="">Select unit‚Ä¶</option>
                <option>Engine 411</option>
                <option>Tanker 413</option>
                <option>Brush 414</option>
                <option>Command 415</option>
                <option>Utility 416</option>
              </select>
            </div>
            <div class="field">
              <label>Checklist</label>
              <div class="checkbox-group" id="tc_checklist_group">
                <label class="checkbox-label"><input type="checkbox" value="Fluids OK"> Fluids OK</label>
                <label class="checkbox-label"><input type="checkbox" value="Lights OK"> Lights OK</label>
                <label class="checkbox-label"><input type="checkbox" value="Equipment OK"> Equipment OK</label>
                <label class="checkbox-label"><input type="checkbox" value="Tires OK"> Tires OK</label>
                <label class="checkbox-label"><input type="checkbox" value="SCBA OK"> SCBA OK</label>
                <label class="checkbox-label"><input type="checkbox" value="Pump OK"> Pump OK</label>
              </div>
            </div>
            <div class="field"><label>Deficiencies / Notes</label><textarea id="tc_deficiencies" placeholder="List any deficiencies found, or leave blank if none‚Ä¶"></textarea></div>
            <div class="field">
              <label>Result</label>
              <div class="result-group">
                <button class="result-btn" id="tc_pass" onclick="selectResult('tc','Pass')">‚úì Pass</button>
                <button class="result-btn" id="tc_minor" onclick="selectResult('tc','Minor')">‚ö† Minor</button>
                <button class="result-btn" id="tc_fail" onclick="selectResult('tc','Fail')">‚úï Fail</button>
              </div>
            </div>
            <div class="field"><label>Submitted By</label><input type="text" id="tc_submitted_by" readonly style="opacity:0.6;cursor:not-allowed;"></div>
            <div class="form-submit-row">
              <button class="btn-sm primary" style="max-width:200px;" onclick="submitTruckCheck()">üöí Submit Check</button>
              <button class="btn-sm" style="background:rgba(255,255,255,0.07);border:1px solid var(--glass-border);color:var(--text-secondary);padding:10px 18px;border-radius:10px;cursor:pointer;font-family:'DM Sans',sans-serif;font-size:13px;" onclick="resetTruckForm()">Clear</button>
            </div>
          </div>
        </div>
        <div id="truck-history" style="display:none;">
          <div class="submissions-list" id="truck-submissions-list">
            <div class="submissions-loading">Loading‚Ä¶</div>
          </div>
        </div>
      </div>

      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SETTINGS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <div class="page" id="page-settings">
        <div class="settings-section">
          <div class="settings-title">Profile</div>
          <div class="settings-sub">Update your personal information and preferences.</div>
          <div class="profile-pic-area">
            <div class="profile-pic" id="settingsAvatar">D</div>
            <div>
              <div style="font-size:14px;font-weight:600;" id="settingsName">Dkota</div>
              <div style="font-size:12px;color:var(--text-secondary);">Administrator ¬∑ Badge #001</div>
              <div style="font-size:12px;color:var(--red);cursor:pointer;margin-top:4px;">Change photo</div>
            </div>
          </div>
          <div class="field"><label>Display Name</label><input type="text" id="settingsNameInput" value="Dkota"></div>
          <div class="field"><label>Email</label><input type="email" value="dkota@coltonfire.org"></div>
          <div style="margin-top:16px;">
            <button class="btn-sm primary" style="max-width:160px;" onclick="showToast('Profile updated!','success')">Save Changes</button>
          </div>
        </div>

        <div class="settings-section">
          <div class="settings-title">Change PIN</div>
          <div class="settings-sub">Update your 4-digit sign-in PIN.</div>
          <div class="field"><label>Current PIN</label><input type="password" maxlength="4" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" id="oldPin"></div>
          <div class="field"><label>New PIN</label><input type="password" maxlength="4" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" id="newPin"></div>
          <div class="field"><label>Confirm New PIN</label><input type="password" maxlength="4" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" id="confirmPin"></div>
          <button class="btn-sm primary" style="max-width:160px;margin-top:8px;" onclick="changePin()">Update PIN</button>
        </div>

        <div class="settings-section">
          <div class="settings-title">Notifications</div>
          <div class="settings-sub">Control what alerts you receive.</div>
          <div class="settings-row">
            <div class="settings-row-left"><div class="settings-row-label">New Call Alerts</div><div class="settings-row-sub">Get notified when a new call log is submitted</div></div>
            <label class="toggle"><input type="checkbox" checked><span class="toggle-slider"></span></label>
          </div>
          <div class="settings-row">
            <div class="settings-row-left"><div class="settings-row-label">Apparatus Status Changes</div><div class="settings-row-sub">Alert when unit status is updated</div></div>
            <label class="toggle"><input type="checkbox" checked><span class="toggle-slider"></span></label>
          </div>
          <div class="settings-row">
            <div class="settings-row-left"><div class="settings-row-label">Department Announcements</div><div class="settings-row-sub">New announcements from admin</div></div>
            <label class="toggle"><input type="checkbox" checked><span class="toggle-slider"></span></label>
          </div>
          <div class="settings-row">
            <div class="settings-row-left"><div class="settings-row-label">Weekly Digest</div><div class="settings-row-sub">Summary email every Sunday</div></div>
            <label class="toggle"><input type="checkbox"><span class="toggle-slider"></span></label>
          </div>
        </div>
      </div>

      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ADMIN ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <div class="page" id="page-admin">
        <div class="admin-tabs">
          <button class="admin-tab active" onclick="switchAdminTab('requests',this)">üì• Requests <span class="nav-badge" style="margin-left:6px;background:rgba(230,57,70,0.8);">3</span></button>
          <button class="admin-tab" onclick="switchAdminTab('members',this)">üë• Members</button>
          <button class="admin-tab" onclick="switchAdminTab('apparatus',this)">üöí Apparatus</button>
          <button class="admin-tab" onclick="switchAdminTab('announce',this)">üì¢ Announce</button>
          <button class="admin-tab" onclick="switchAdminTab('links',this)">üîó Links</button>
          <button class="admin-tab" onclick="switchAdminTab('access',this)">üîë Access</button>
          <button class="admin-tab" onclick="switchAdminTab('firebase',this)">üî• Firebase</button>
        </div>

        <!-- Access Requests -->
        <div class="admin-section active" id="admin-requests">
          <div class="table-wrap">
            <table>
              <thead><tr><th>Name</th><th>Badge #</th><th>Email</th><th>Rank</th><th>Requested</th><th>Actions</th></tr></thead>
              <tbody id="requestsTable">
                <tr id="req_row_1"><td><strong>Tyler Brooks</strong></td><td><span style="font-family:'JetBrains Mono',monospace;">5521</span></td><td>t.brooks@email.com</td><td>Firefighter</td><td><span style="font-family:'JetBrains Mono',monospace;font-size:11px;">02/15/26</span></td><td style="display:flex;gap:6px;flex-wrap:wrap;"><button class="action-btn approve" onclick="approveRequest('req_row_1','Tyler Brooks')">‚úì Approve</button><button class="action-btn deny" onclick="denyRequest('req_row_1')">‚úï Deny</button></td></tr>
                <tr id="req_row_2"><td><strong>Maria Santos</strong></td><td><span style="font-family:'JetBrains Mono',monospace;">5522</span></td><td>m.santos@email.com</td><td>EMT</td><td><span style="font-family:'JetBrains Mono',monospace;font-size:11px;">02/16/26</span></td><td style="display:flex;gap:6px;flex-wrap:wrap;"><button class="action-btn approve" onclick="approveRequest('req_row_2','Maria Santos')">‚úì Approve</button><button class="action-btn deny" onclick="denyRequest('req_row_2')">‚úï Deny</button></td></tr>
                <tr id="req_row_3"><td><strong>Derek Paulson</strong></td><td><span style="font-family:'JetBrains Mono',monospace;">5523</span></td><td>d.paulson@email.com</td><td>Probationary FF</td><td><span style="font-family:'JetBrains Mono',monospace;font-size:11px;">02/17/26</span></td><td style="display:flex;gap:6px;flex-wrap:wrap;"><button class="action-btn approve" onclick="approveRequest('req_row_3','Derek Paulson')">‚úì Approve</button><button class="action-btn deny" onclick="denyRequest('req_row_3')">‚úï Deny</button></td></tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Members -->
        <div class="admin-section" id="admin-members">
          <div class="settings-section" style="margin-bottom:16px;">
            <div class="settings-title">Add Member to Roster</div>
            <div class="settings-sub">Added members appear in the Call Log personnel selector.</div>
            <div class="form-grid-2">
              <div class="field"><label>Full Name</label><input type="text" id="new_member_name" placeholder="e.g. FF John Smith"></div>
              <div class="field">
                <label>Rank</label>
                <select id="new_member_rank">
                  <option value="">Select rank‚Ä¶</option>
                  <option>Chief</option>
                  <option>Deputy Chief</option>
                  <option>Captain</option>
                  <option>Lieutenant</option>
                  <option>Firefighter</option>
                  <option>EMT</option>
                  <option>Probationary FF</option>
                  <option>Admin</option>
                </select>
              </div>
            </div>
            <button class="btn-sm primary" style="max-width:180px;" onclick="addRosterMember()">+ Add Member</button>
          </div>
          <div class="table-wrap">
            <table>
              <thead><tr><th>Name</th><th>Rank</th><th>Added</th><th>Actions</th></tr></thead>
              <tbody id="rosterAdminTable"><tr><td colspan="4" style="text-align:center;color:var(--text-secondary);padding:20px;">Loading roster‚Ä¶</td></tr></tbody>
            </table>
          </div>
        </div>

        <!-- Apparatus Management -->
        <div class="admin-section" id="admin-apparatus">
          <div class="table-wrap">
            <table>
              <thead><tr><th>Unit</th><th>Type</th><th>Year / Model</th><th>Status</th><th>Updated</th></tr></thead>
              <tbody id="apparatusAdminTable"></tbody>
            </table>
          </div>
          <button class="btn-sm primary" style="max-width:200px;margin-top:16px;" onclick="showToast('Add apparatus coming soon','info')">+ Add Apparatus</button>
        </div>

        <!-- Announcements -->
        <div class="admin-section" id="admin-announce">
          <div class="settings-section" style="margin-bottom:0;">
            <div class="settings-title">Publish Announcement</div>
            <div class="settings-sub">This will appear on the Dashboard for all members.</div>
            <div class="field"><label>Announcement Text</label>
              <textarea id="announceText" style="width:100%;padding:12px 14px;background:rgba(255,255,255,0.06);border:1px solid var(--glass-border);border-radius:10px;color:white;font-family:'DM Sans',sans-serif;font-size:14px;outline:none;resize:vertical;min-height:100px;line-height:1.6;">Training drill this Saturday at 0800. All members required to attend. Contact Chief Harmon for any scheduling conflicts.</textarea>
            </div>
            <button class="btn-sm primary" style="max-width:200px;" onclick="publishAnnouncement()">üì¢ Publish</button>
          </div>
        </div>

        <!-- Links Manager -->
        <div class="admin-section" id="admin-links">
          <div class="table-wrap" style="margin-bottom:16px;">
            <table>
              <thead><tr><th>Label</th><th>URL</th><th>Actions</th></tr></thead>
              <tbody id="linksTable">
                <tr><td>Colton Fire Website</td><td><span style="font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--text-secondary);">https://coltonfire.org</span></td><td><button class="action-btn edit">Edit</button></td></tr>
                <tr><td>Firehouse Solutions</td><td><span style="font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--text-secondary);">https://firehousesolutions.com</span></td><td><button class="action-btn edit">Edit</button></td></tr>
                <tr><td>Member Login Portal</td><td><span style="font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--text-secondary);">https://members.coltonfire.org</span></td><td><button class="action-btn edit">Edit</button></td></tr>
              </tbody>
            </table>
          </div>
          <button class="btn-sm primary" style="max-width:200px;" onclick="showToast('Link management coming soon','info')">+ Add Link</button>
        </div>

        <!-- App Access -->
        <div class="admin-section" id="admin-access">
          <div class="settings-section" style="margin-bottom:16px;">
            <div class="settings-title">Grant App Access</div>
            <div class="settings-sub">Add a member to the login screen. They'll use their name and the PIN you set.</div>
            <div class="form-grid-2">
              <div class="field"><label>Full Name</label><input type="text" id="acc_name" placeholder="e.g. FF John Smith"></div>
              <div class="field">
                <label>Rank</label>
                <select id="acc_rank">
                  <option value="">Select rank‚Ä¶</option>
                  <option>Chief</option>
                  <option>Deputy Chief</option>
                  <option>Captain</option>
                  <option>Lieutenant</option>
                  <option>Firefighter</option>
                  <option>EMT</option>
                  <option>Probationary FF</option>
                </select>
              </div>
            </div>
            <div class="field"><label>Email Address</label><input type="email" id="acc_email" placeholder="member@email.com"></div>
            <div class="form-grid-2">
              <div class="field">
                <label>Role</label>
                <select id="acc_role">
                  <option value="member">Member</option>
                  <option value="admin">Admin</option>
                </select>
              </div>
              <div class="field"><label>Starting Password</label><input type="password" id="acc_pin" placeholder="Min 6 characters"></div>
            </div>
            <button class="btn-sm primary" style="max-width:200px;" onclick="addAppMember()">üîë Grant Access</button>
          </div>
          <div class="table-wrap">
            <table>
              <thead><tr><th>Name</th><th>Rank</th><th>Role</th><th>Actions</th></tr></thead>
              <tbody id="accessMembersTable"><tr><td colspan="4" style="text-align:center;color:var(--text-secondary);padding:20px;">Loading‚Ä¶</td></tr></tbody>
            </table>
          </div>
        </div>

        <!-- Firebase Setup -->
        <div class="admin-section" id="admin-firebase">
          <div class="settings-section">
            <div class="settings-title">Firebase Connection</div>
            <div class="settings-sub">Status of your Firestore database connection.</div>
            <div class="config-status-row" id="fb-config-status-row">
              <div class="dot red"></div>
              <span style="color:var(--red);font-weight:600;">Not Configured</span>
              <span style="color:var(--text-secondary);margin-left:4px;">‚Äî checking‚Ä¶</span>
            </div>
            <div class="settings-title" style="margin-top:20px;">Setup Instructions</div>
            <div class="settings-sub">Your Firebase config is already set. If you need to update it, open <code style="color:var(--gold);font-size:12px;">colton-fire.html</code> in a text editor and find the <code style="color:var(--gold);font-size:12px;">FIREBASE_CONFIG</code> block.</div>
            <div style="margin-top:20px;">
              <div style="font-size:13px;font-weight:600;margin-bottom:8px;color:var(--text-primary);">Firestore Security Rules</div>
              <div style="font-size:13px;color:var(--text-secondary);line-height:1.7;margin-bottom:10px;">After testing, tighten your rules in Firebase Console ‚Üí Firestore ‚Üí Rules:</div>
              <div class="config-pre">rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /{document=**} {
      allow read, write: if true; // tighten after testing
    }
  }
}</div>
            </div>
          </div>
        </div>
      </div>

    </div><!-- /content-area -->
  </div><!-- /main-content -->

  <!-- BOTTOM NAV (mobile) -->
  <div class="bottom-nav">
    <div class="bottom-nav-item active" onclick="navigate('dashboard',null,'bn-dash');setBnActive(this)">
      <div class="bottom-nav-icon">üè†</div>
      <div class="bottom-nav-label">Home</div>
    </div>
    <div class="bottom-nav-item" onclick="navigate('callogs',null,'bn-call');setBnActive(this)">
      <div class="bottom-nav-icon">üìã</div>
      <div class="bottom-nav-label">Calls</div>
    </div>
    <div class="bottom-nav-item" onclick="navigate('rescue',null,'bn-res');setBnActive(this)">
      <div class="bottom-nav-icon">üöë</div>
      <div class="bottom-nav-label">Rescue</div>
    </div>
    <div class="bottom-nav-item" onclick="navigate('trucks',null,'bn-trk');setBnActive(this)">
      <div class="bottom-nav-icon">üöí</div>
      <div class="bottom-nav-label">Trucks</div>
    </div>
    <div class="bottom-nav-item" onclick="navigate('settings',null,'bn-set');setBnActive(this)">
      <div class="bottom-nav-icon">‚öôÔ∏è</div>
      <div class="bottom-nav-label">Settings</div>
    </div>
  </div>

</div><!-- /app -->

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<!--  JAVASCRIPT                                    -->
<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<script>
// ‚îÄ‚îÄ DATA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const MEMBERS = {
  'dkota_admin': { name: 'Dkota Wright', role: 'admin', initial: 'D' }
};

// Default PINs ‚Äî overridden by localStorage if user has changed theirs
const DEFAULT_PINS = {
  'dkota_admin': '0508'
};
function getPin(uid) { return localStorage.getItem('cvfd_pin_' + uid) || DEFAULT_PINS[uid]; }
function setPin(uid, pin) { localStorage.setItem('cvfd_pin_' + uid, pin); }

let apparatus = [
  { id: 'e411', icon: 'üöí', name: 'Engine 411', type: 'Pumper Engine', year: '2018', model: 'Pierce Enforcer', status: 'in_service' },
  { id: 'r412', icon: 'üöë', name: 'Rescue 412', type: 'Heavy Rescue', year: '2021', model: 'Horton Commander', status: 'in_service' },
  { id: 't413', icon: 'üöí', name: 'Tanker 413', type: 'Water Tanker', year: '2015', model: 'Darley Tank', status: 'on_scene' },
  { id: 'b414', icon: 'üöí', name: 'Brush 414', type: 'Brush Truck', year: '2019', model: 'Ford F-550', status: 'in_service' },
  { id: 'c415', icon: 'üöí', name: 'Command 415', type: 'Command Vehicle', year: '2022', model: 'Chevy Tahoe', status: 'out_of_service' },
  { id: 'u416', icon: 'üöê', name: 'Utility 416', type: 'Support Unit', year: '2020', model: 'Ford Transit', status: 'in_service' },
];

const siteLinks = [
  { label: 'Colton Fire Website', url: 'https://coltonfire.org' },
  { label: 'Firehouse Solutions', url: 'https://firehousesolutions.com' },
  { label: 'Member Login Portal', url: 'https://members.coltonfire.org' },
];

const recentActivity = [
  { icon: 'üìã', bg: 'rgba(230,57,70,0.15)', title: 'Call Log submitted ‚Äî Structure Fire', time: '02/16 14:32', badge: 'Call', badgeColor: 'red' },
  { icon: 'üöë', bg: 'rgba(244,162,97,0.15)', title: 'Rescue 412 check completed', time: '02/17 07:30', badge: 'Check', badgeColor: 'amber' },
  { icon: 'üë§', bg: 'rgba(74,158,255,0.15)', title: 'Access request: Tyler Brooks', time: '02/15 16:10', badge: 'Admin', badgeColor: 'blue' },
  { icon: 'üöí', bg: 'rgba(46,204,113,0.15)', title: 'Engine 411 status: In Service', time: '02/15 08:00', badge: 'Status', badgeColor: 'green' },
  { icon: 'üì¢', bg: 'rgba(244,162,97,0.15)', title: 'Announcement posted by Admin', time: '02/14 09:00', badge: 'Announce', badgeColor: 'amber' },
];

let currentUser = null;
let currentPin = '';
let pendingCount = 3;

// ‚îÄ‚îÄ AUTH ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function onMemberSelect() {
  const val = document.getElementById('memberSelect').value;
  const pinSec = document.getElementById('pin-section');
  currentPin = '';
  const inp = document.getElementById('pinTextInput');
  if (inp) inp.value = '';
  // Adjust input for PIN (admin) vs password (Firebase Auth members)
  const label = document.getElementById('pin-label');
  if (val === 'dkota_admin') {
    if (inp) { inp.maxLength = 4; inp.inputMode = 'numeric'; inp.pattern = '[0-9]*'; inp.placeholder = '‚Ä¢‚Ä¢‚Ä¢‚Ä¢'; inp.style.letterSpacing = '8px'; inp.style.fontSize = '22px'; }
    if (label) label.textContent = 'Enter your PIN';
  } else {
    if (inp) { inp.maxLength = 128; inp.inputMode = 'text'; inp.pattern = ''; inp.placeholder = 'Password'; inp.style.letterSpacing = '2px'; inp.style.fontSize = '18px'; }
    if (label) label.textContent = 'Enter your password';
  }
  if (val) {
    pinSec.classList.add('visible');
    setTimeout(() => { if (inp) inp.focus(); }, 50);
  } else {
    pinSec.classList.remove('visible');
  }
}

function onPinTextInput(input) {
  const uid = document.getElementById('memberSelect').value;
  if (uid === 'dkota_admin') {
    // Only allow digits for PIN
    input.value = input.value.replace(/\D/g,'');
    currentPin = input.value;
    if (currentPin.length === 4) {
      setTimeout(checkPin, 120);
    }
  } else {
    // Allow any characters for password
    currentPin = input.value;
  }
}

function updatePinDisplay() {
  const input = document.getElementById('pinTextInput');
  if (input) input.value = '';
  currentPin = '';
}

function checkPin() {
  const uid = document.getElementById('memberSelect').value;
  if (!uid) { showToast('Please select your name', 'error'); return; }

  if (uid === 'dkota_admin') {
    // Admin uses PIN system
    const correct = getPin(uid);
    if (currentPin === correct) {
      document.getElementById('authCard').classList.add('success');
      setTimeout(() => enterApp(uid), 500);
    } else {
      document.getElementById('authCard').classList.add('shake');
      setTimeout(() => {
        document.getElementById('authCard').classList.remove('shake');
        currentPin = '';
        const inp = document.getElementById('pinTextInput');
        if (inp) { inp.value = ''; inp.focus(); }
      }, 450);
    }
  } else {
    // Firebase Auth members use email + password
    const member = appMembersCache.find(m => m.docId === uid);
    if (!member || !member.email) { showToast('Member account not found', 'error'); return; }
    const password = document.getElementById('pinTextInput').value;
    if (!password) { showToast('Please enter your password', 'error'); return; }
    if (!auth) { showToast('Authentication not available', 'error'); return; }
    auth.signInWithEmailAndPassword(member.email, password)
      .catch(err => {
        showToast('Incorrect password', 'error');
        currentPin = '';
        const inp = document.getElementById('pinTextInput');
        if (inp) { inp.value = ''; inp.focus(); }
        document.getElementById('authCard').classList.add('shake');
        setTimeout(() => document.getElementById('authCard').classList.remove('shake'), 450);
      });
    // Success is handled by onAuthStateChanged in initFirebase()
  }
}

function enterApp(uid) {
  currentUser = MEMBERS[uid] || MEMBERS['dkota_admin'];

  // Set sidebar user info
  document.getElementById('sidebarAvatar').textContent = currentUser.initial;
  document.getElementById('sidebarName').textContent = currentUser.name;
  document.getElementById('sidebarRole').textContent = currentUser.role === 'admin' ? 'Administrator' : 'Member';
  document.getElementById('settingsAvatar').textContent = currentUser.initial;
  document.getElementById('settingsName').textContent = currentUser.name;
  document.getElementById('settingsNameInput').value = currentUser.name;

  // Hide admin nav for non-admins
  if (currentUser.role !== 'admin') {
    document.getElementById('adminNavItem').style.display = 'none';
  }

  // Fade out auth, show app
  const auth = document.getElementById('auth-screen');
  auth.style.transition = 'opacity 0.5s ease';
  auth.style.opacity = '0';
  setTimeout(() => {
    auth.style.display = 'none';
    document.getElementById('app').classList.add('visible');
    initDashboard();
    startClock();
    // Only persist session via localStorage for PIN-based admin
    if (uid === 'dkota_admin') localStorage.setItem('cvfd_session', uid);
  }, 500);
}

function logout() {
  // Sign out Firebase Auth session for non-admin users
  if (auth && currentUser && currentUser.role !== 'admin') {
    auth.signOut().catch(e => console.warn('[CVFD] signOut error:', e));
  }
  document.getElementById('app').classList.remove('visible');
  const authScreen = document.getElementById('auth-screen');
  authScreen.style.display = 'flex';
  authScreen.style.opacity = '0';
  setTimeout(() => { authScreen.style.transition = 'opacity 0.4s'; authScreen.style.opacity = '1'; }, 10);
  document.getElementById('memberSelect').value = '';
  document.getElementById('pin-section').classList.remove('visible');
  currentPin = '';
  const inp = document.getElementById('pinTextInput');
  if (inp) { inp.value = ''; inp.maxLength = 4; inp.inputMode = 'numeric'; inp.placeholder = '‚Ä¢‚Ä¢‚Ä¢‚Ä¢'; inp.style.letterSpacing = '8px'; inp.style.fontSize = '22px'; }
  const label = document.getElementById('pin-label');
  if (label) label.textContent = 'Enter your PIN';
  document.getElementById('authCard').classList.remove('success');
  currentUser = null;
  localStorage.removeItem('cvfd_session');
}

// ‚îÄ‚îÄ INIT DASHBOARD ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function initDashboard() {
  renderApparatusGrid();
  renderApparatusAdminTable();
  renderSiteStatus();
  renderActivityFeed();
}

function renderApparatusGrid() {
  const grid = document.getElementById('apparatusGrid');
  grid.innerHTML = apparatus.map((a, i) => {
    const s = statusConfig(a.status);
    return `<div class="apparatus-card" style="animation-delay:${i*0.06}s">
      <div class="apparatus-icon">${a.icon}</div>
      <div class="apparatus-name">${a.name}</div>
      <div class="apparatus-type">${a.type} ¬∑ ${a.year}</div>
      <div class="apparatus-status">
        <div class="dot ${s.dot}"></div>
        <span class="apparatus-status-text ${s.dot}">${s.label}</span>
      </div>
    </div>`;
  }).join('');
}

function renderApparatusAdminTable() {
  const tbody = document.getElementById('apparatusAdminTable');
  tbody.innerHTML = apparatus.map(a => {
    const s = statusConfig(a.status);
    return `<tr>
      <td><strong>${a.name}</strong></td>
      <td>${a.type}</td>
      <td><span style="font-family:'JetBrains Mono',monospace;font-size:12px;">${a.year} ${a.model}</span></td>
      <td>
        <select class="status-select" onchange="updateApparatusStatus('${a.id}',this.value)">
          <option value="in_service" ${a.status==='in_service'?'selected':''}>üü¢ In Service</option>
          <option value="on_scene" ${a.status==='on_scene'?'selected':''}>üü° On Scene</option>
          <option value="out_of_service" ${a.status==='out_of_service'?'selected':''}>üî¥ Out of Service</option>
        </select>
      </td>
      <td><span style="font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--text-secondary);">Just now</span></td>
    </tr>`;
  }).join('');
}

function statusConfig(status) {
  if (status === 'in_service') return { dot: 'green', label: 'In Service' };
  if (status === 'on_scene') return { dot: 'amber', label: 'On Scene' };
  return { dot: 'red', label: 'Out of Service' };
}

function updateApparatusStatus(id, newStatus) {
  const unit = apparatus.find(a => a.id === id);
  if (unit) {
    unit.status = newStatus;
    renderApparatusGrid();
    showToast(`${unit.name} ‚Üí ${statusConfig(newStatus).label}`, 'success');
  }
}

function renderSiteStatus() {
  const list = document.getElementById('siteStatusList');
  list.innerHTML = siteLinks.map(link => `
    <div class="status-row">
      <div class="dot green"></div>
      <div class="status-row-left">
        <div class="status-row-label">${link.label}</div>
        <div class="status-row-url">${link.url.replace('https://','')}</div>
      </div>
      <a href="${link.url}" target="_blank" class="status-link">‚Üó</a>
    </div>
  `).join('');
}

function renderActivityFeed() {
  const feed = document.getElementById('activityFeed');
  feed.innerHTML = recentActivity.map(item => `
    <div class="activity-item">
      <div class="activity-icon" style="background:${item.bg}">${item.icon}</div>
      <div class="activity-text">
        <div class="activity-title">${item.title}</div>
        <div class="activity-time">${item.time}</div>
      </div>
      <span class="badge ${item.badgeColor}">${item.badge}</span>
    </div>
  `).join('');
}

// ‚îÄ‚îÄ NAVIGATION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function navigate(pageId, navEl) {
  // Pages
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById('page-' + pageId).classList.add('active');

  // Sidebar nav highlight
  if (navEl) {
    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
    navEl.classList.add('active');
  }

  // Topbar title
  const titles = {
    dashboard: 'Dashboard', callogs: 'Call Run Logs', rescue: 'Rescue Checks',
    trucks: 'Truck Checks', settings: 'Settings', admin: 'Admin Panel'
  };
  document.getElementById('topbarTitle').textContent = titles[pageId] || pageId;

  // Init forms on navigate
  if (pageId === 'callogs') initCallLogForm();
  if (pageId === 'rescue')  initRescueForm();
  if (pageId === 'trucks')  initTruckForm();

  closeSidebar();
}

function setBnActive(el) {
  document.querySelectorAll('.bottom-nav-item').forEach(i => i.classList.remove('active'));
  el.classList.add('active');
}

// ‚îÄ‚îÄ ADMIN TABS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function switchAdminTab(tab, btn) {
  document.querySelectorAll('.admin-section').forEach(s => s.classList.remove('active'));
  document.getElementById('admin-' + tab).classList.add('active');
  if (tab === 'firebase') renderFirebaseStatus();
  if (tab === 'members') loadRoster();
  if (tab === 'access') loadAppMembers();
  if (btn) {
    document.querySelectorAll('.admin-tab').forEach(t => t.classList.remove('active'));
    btn.classList.add('active');
  } else {
    // called programmatically
    document.querySelectorAll('.admin-tab').forEach(t => {
      if (t.onclick && t.onclick.toString().includes(tab)) t.classList.add('active');
    });
  }
}

// ‚îÄ‚îÄ ACCESS REQUESTS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function approveRequest(rowId, name) {
  const row = document.getElementById(rowId);
  if (row) {
    row.style.transition = 'opacity 0.3s, transform 0.3s';
    row.style.opacity = '0'; row.style.transform = 'translateX(20px)';
    setTimeout(() => { row.remove(); updatePendingCount(-1); }, 300);
  }
  // Add to member select dropdown
  const sel = document.getElementById('memberSelect');
  const opt = document.createElement('option');
  const uid = name.toLowerCase().replace(' ','_');
  opt.value = uid; opt.textContent = name;
  sel.appendChild(opt);
  MEMBERS[uid] = { name, role: 'member', initial: name[0] };
  setPin(uid, '1234');

  showToast(`${name} approved & added to members`, 'success');
}

function denyRequest(rowId) {
  const row = document.getElementById(rowId);
  if (row) {
    row.style.transition = 'opacity 0.3s';
    row.style.opacity = '0';
    setTimeout(() => { row.remove(); updatePendingCount(-1); }, 300);
  }
  showToast('Request denied', 'info');
}

function updatePendingCount(delta) {
  pendingCount = Math.max(0, pendingCount + delta);
  const badge = document.getElementById('adminBadge');
  const dashBadge = document.getElementById('dashPendingCount');
  if (badge) badge.textContent = pendingCount;
  if (dashBadge) dashBadge.textContent = pendingCount;
  if (pendingCount === 0 && badge) badge.style.display = 'none';
}

// ‚îÄ‚îÄ FORM TABS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function switchFormTab(btn, sectionId) {
  // Find parent container and hide all siblings
  const parent = btn.parentElement;
  parent.querySelectorAll('.form-tab').forEach(t => t.classList.remove('active'));
  btn.classList.add('active');

  // Show/hide content
  const container = parent.parentElement;
  const contents = container.querySelectorAll(':scope > div');
  contents.forEach(d => {
    if (d.contains(parent)) return; // skip tabs bar
    d.style.display = 'none';
  });
  const target = document.getElementById(sectionId);
  if (target) target.style.display = 'block';

  // Load history from Firestore when switching to history tabs
  if (sectionId === 'calllog-history') loadCallLogHistory();
  if (sectionId === 'rescue-history')  loadRescueHistory();
  if (sectionId === 'truck-history')   loadTruckHistory();
}

// ‚îÄ‚îÄ LOAD MS FORMS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function loadForm(type) {
  const urlMap = { calllog: 'calllogUrl', rescue: 'rescueUrl', truck: 'truckUrl' };
  const wrapMap = { calllog: 'callogFormWrap' };
  const url = document.getElementById(urlMap[type])?.value?.trim();
  if (!url || !url.startsWith('http')) {
    showToast('Please enter a valid Microsoft Forms URL', 'error'); return;
  }
  const placeholder = document.getElementById(urlMap[type])?.closest('.form-embed-wrap')?.querySelector('.form-placeholder');
  const wrap = placeholder?.parentElement;
  if (wrap) {
    wrap.innerHTML = `<iframe src="${url}" width="100%" height="100%" frameborder="0" style="border:none;"></iframe>`;
  }
  showToast('Form loaded!', 'success');
}

// ‚îÄ‚îÄ SETTINGS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function changePin() {
  const oldP = document.getElementById('oldPin').value;
  const newP = document.getElementById('newPin').value;
  const conP = document.getElementById('confirmPin').value;
  if (!oldP || !newP || !conP) { showToast('Please fill all PIN fields', 'error'); return; }
  if (oldP !== getPin(currentUser)) { showToast('Current PIN is incorrect', 'error'); return; }
  if (newP !== conP) { showToast('New PINs do not match', 'error'); return; }
  if (newP.length < 4) { showToast('PIN must be 4 digits', 'error'); return; }
  setPin(currentUser, newP);
  showToast('PIN updated successfully', 'success');
  document.getElementById('oldPin').value = '';
  document.getElementById('newPin').value = '';
  document.getElementById('confirmPin').value = '';
}

// ‚îÄ‚îÄ ANNOUNCEMENT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function publishAnnouncement() {
  const text = document.getElementById('announceText').value.trim();
  if (!text) { showToast('Please enter announcement text', 'error'); return; }
  document.getElementById('announcementText').textContent = text;
  showToast('Announcement published to all members', 'success');
}

// ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function openModal(id) { document.getElementById(id).classList.add('open'); }
function closeModal(id) { document.getElementById(id).classList.remove('open'); }
document.querySelectorAll('.modal-overlay').forEach(m => {
  m.addEventListener('click', e => { if (e.target === m) m.classList.remove('open'); });
});

function submitRequest() {
  const name = document.getElementById('req_name').value.trim();
  const badge = document.getElementById('req_badge').value.trim();
  const email = document.getElementById('req_email').value.trim();
  const rank = document.getElementById('req_rank').value;
  if (!name || !badge || !email || !rank) { showToast('Please fill all fields', 'error'); return; }
  closeModal('requestModal');
  showToast('Access request submitted! Admin will review shortly.', 'success');
  ['req_name','req_badge','req_email'].forEach(id => document.getElementById(id).value = '');
  document.getElementById('req_rank').value = '';
}

// ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function showToast(message, type = 'info') {
  const icons = { success: '‚úÖ', error: '‚ö†Ô∏è', info: '‚ÑπÔ∏è' };
  const container = document.getElementById('toastContainer');
  const toast = document.createElement('div');
  toast.className = `toast ${type}`;
  toast.innerHTML = `<span class="toast-icon">${icons[type]}</span>${message}`;
  container.appendChild(toast);
  setTimeout(() => {
    toast.style.transition = 'opacity 0.3s, transform 0.3s';
    toast.style.opacity = '0'; toast.style.transform = 'translateX(120%)';
    setTimeout(() => toast.remove(), 300);
  }, 3500);
}

// ‚îÄ‚îÄ CLOCK ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function startClock() {
  function tick() {
    const now = new Date();
    document.getElementById('liveClock').textContent =
      now.toLocaleDateString('en-US', { weekday:'short', month:'short', day:'numeric' }) + ' ¬∑ ' +
      now.toLocaleTimeString('en-US', { hour:'2-digit', minute:'2-digit', second:'2-digit' });
  }
  tick(); setInterval(tick, 1000);
}

// ‚îÄ‚îÄ SIDEBAR MOBILE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function toggleSidebar() {
  document.getElementById('sidebar').classList.toggle('open');
  document.getElementById('sidebarOverlay').classList.toggle('open');
}
function closeSidebar() {
  document.getElementById('sidebar').classList.remove('open');
  document.getElementById('sidebarOverlay').classList.remove('open');
}

// ‚îÄ‚îÄ EMBERS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function createEmbers() {
  const authScreen = document.getElementById('auth-screen');
  const colors = ['#E63946','#F4A261','#F39C12','#ff6b35'];
  for (let i = 0; i < 18; i++) {
    const e = document.createElement('div');
    e.className = 'ember';
    const hue = colors[Math.floor(Math.random() * colors.length)];
    e.style.cssText = `
      left: ${Math.random()*100}%;
      background: ${hue};
      box-shadow: 0 0 6px ${hue};
      --dx: ${(Math.random()-0.5)*160}px;
      animation-duration: ${5 + Math.random()*8}s;
      animation-delay: ${Math.random()*6}s;
      width: ${2+Math.random()*3}px;
      height: ${2+Math.random()*3}px;
    `;
    authScreen.appendChild(e);
  }
}
createEmbers();

// ‚îÄ‚îÄ FIREBASE CONFIG & INIT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const FIREBASE_CONFIG = {
  apiKey:            "AIzaSyDGPuxUvGIHO8aKnP3CxyIJVEzuDdAjJ4Q",
  authDomain:        "coltonfireapp.firebaseapp.com",
  projectId:         "coltonfireapp",
  storageBucket:     "coltonfireapp.firebasestorage.app",
  messagingSenderId: "811650478121",
  appId:             "1:811650478121:web:46f15087c601019946ec38"
};

let db = null;
let auth = null;
let firebaseReady = false;

function initFirebase() {
  try {
    if (!firebase.apps.length) firebase.initializeApp(FIREBASE_CONFIG);
    db   = firebase.firestore();
    auth = firebase.auth();
    firebaseReady = true;
    console.log('[CVFD] Firebase connected');

    // Firebase Auth session persistence ‚Äî auto-restores login after refresh
    auth.onAuthStateChanged(user => {
      if (user && !currentUser) {
        // Find member by Firebase Auth UID in our cache
        const match = appMembersCache.find(m => m.authUid === user.uid);
        if (match && MEMBERS[match.docId]) {
          enterApp(match.docId);
        }
        // If cache not yet loaded (timing race), loadAppMembers() will handle it
      }
    });
  } catch(e) {
    console.error('[CVFD] Firebase init failed:', e);
  }
}
initFirebase();
loadRoster();
loadAppMembers(); // populates dropdown; auth.onAuthStateChanged handles session restore

// ‚îÄ‚îÄ APP ACCESS (LOGIN MEMBERS) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let appMembersCache = []; // { docId, name, rank, role, email, authUid }

function loadAppMembers() {
  return new Promise(resolve => {
    if (!firebaseReady) { resolve(); return; }
    db.collection('appMembers').orderBy('name').get().then(snap => {
      appMembersCache = [];
      const sel = document.getElementById('memberSelect');
      Array.from(sel.options).forEach(opt => {
        if (opt.value !== '' && opt.value !== 'dkota_admin') opt.remove();
      });
      snap.docs.forEach(doc => {
        const d = doc.data();
        appMembersCache.push({ docId: doc.id, name: d.name, rank: d.rank || '', role: d.role || 'member', email: d.email || '', authUid: d.authUid || '' });
        MEMBERS[doc.id] = { name: d.name, role: d.role || 'member', initial: d.name[0].toUpperCase() };
        const opt = document.createElement('option');
        opt.value = doc.id;
        opt.textContent = d.name + (d.rank ? ' ¬∑ ' + d.rank : '');
        sel.appendChild(opt);
      });
      renderAccessTable(snap.docs);
      // Handle timing race: if onAuthStateChanged already fired before cache was ready
      if (auth && !currentUser) {
        const fbUser = auth.currentUser;
        if (fbUser) {
          const match = appMembersCache.find(m => m.authUid === fbUser.uid);
          if (match && MEMBERS[match.docId]) enterApp(match.docId);
        }
      }
      resolve();
    }).catch(err => { console.error('[CVFD] loadAppMembers failed:', err); resolve(); });
  });
}

function renderAccessTable(docs) {
  const tbody = document.getElementById('accessMembersTable');
  if (!tbody) return;
  if (!docs || docs.length === 0) {
    tbody.innerHTML = '<tr><td colspan="5" style="text-align:center;color:var(--text-secondary);padding:20px;">No members yet. Add one above.</td></tr>';
    return;
  }
  tbody.innerHTML = docs.map(doc => {
    const d = doc.data();
    const hasAuth = !!d.authUid;
    return `<tr>
      <td><strong>${d.name}</strong></td>
      <td>${d.rank || '‚Äî'}</td>
      <td style="font-size:12px;color:var(--text-secondary);">${d.email || '‚Äî'}</td>
      <td><span class="badge ${d.role === 'admin' ? 'red' : 'blue'}">${d.role === 'admin' ? 'Admin' : 'Member'}</span></td>
      <td><button class="action-btn deny" onclick="removeAppMember('${doc.id}','${d.name}','${d.authUid||''}')">Remove</button></td>
    </tr>`;
  }).join('');
}

async function addAppMember() {
  if (!firebaseReady) { showToast('Firebase not connected.','error'); return; }
  const name     = document.getElementById('acc_name').value.trim();
  const rank     = document.getElementById('acc_rank').value;
  const role     = document.getElementById('acc_role').value;
  const email    = document.getElementById('acc_email').value.trim();
  const password = document.getElementById('acc_pin').value;
  if (!name)  { showToast('Name is required','error'); return; }
  if (!email) { showToast('Email is required','error'); return; }
  if (password.length < 6) { showToast('Password must be at least 6 characters','error'); return; }

  const btn = document.querySelector('#admin-access .btn-sm.primary');
  if (btn) { btn.disabled = true; btn.textContent = 'Creating‚Ä¶'; }

  try {
    // Create Firebase Auth user via REST API ‚Äî does NOT sign out the current admin
    const res = await fetch(
      `https://identitytoolkit.googleapis.com/v1/accounts:signUp?key=${FIREBASE_CONFIG.apiKey}`,
      { method: 'POST', headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email, password, returnSecureToken: false }) }
    );
    const data = await res.json();
    if (data.error) throw new Error(data.error.message);
    const authUid = data.localId;

    // Save to Firestore
    await db.collection('appMembers').add({
      name, rank: rank || '', role: role || 'member',
      email, authUid,
      createdAt: firebase.firestore.FieldValue.serverTimestamp()
    });

    showToast(`${name} can now log in!`, 'success');
    ['acc_name','acc_email','acc_pin'].forEach(id => { const el = document.getElementById(id); if(el) el.value=''; });
    document.getElementById('acc_rank').value = '';
    document.getElementById('acc_role').value = 'member';
    if (btn) { btn.disabled = false; btn.textContent = 'üîë Grant Access'; }
    loadAppMembers();
  } catch(err) {
    console.error(err);
    const msg = err.message.includes('EMAIL_EXISTS') ? 'That email already has an account.' : err.message;
    showToast(msg, 'error');
    if (btn) { btn.disabled = false; btn.textContent = 'üîë Grant Access'; }
  }
}

function removeAppMember(docId, name, authUid) {
  if (!confirm(`Remove ${name}'s app access? They will no longer be able to log in.`)) return;
  const del = db.collection('appMembers').doc(docId).delete();
  // Also delete Firebase Auth user via REST (best-effort)
  if (authUid && auth) {
    auth.currentUser?.getIdToken().then(token => {
      fetch(`https://identitytoolkit.googleapis.com/v1/accounts:delete?key=${FIREBASE_CONFIG.apiKey}`,
        { method: 'POST', headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
          body: JSON.stringify({ localId: authUid }) }).catch(() => {});
    }).catch(() => {});
  }
  del.then(() => {
    delete MEMBERS[docId];
    const sel = document.getElementById('memberSelect');
    const opt = sel.querySelector(`option[value="${docId}"]`);
    if (opt) opt.remove();
    appMembersCache = appMembersCache.filter(m => m.docId !== docId);
    showToast(`${name} access removed`, 'info');
    loadAppMembers();
  }).catch(err => { console.error(err); showToast('Failed to remove.','error'); });
}


function renderFirebaseStatus() {
  const row = document.getElementById('fb-config-status-row');
  if (!row) return;
  if (firebaseReady) {
    row.innerHTML = '<div class="dot green"></div><span style="color:var(--green);font-weight:600;">Connected</span><span style="color:var(--text-secondary);margin-left:6px;">‚Äî Firestore is active</span>';
  } else {
    row.innerHTML = '<div class="dot red"></div><span style="color:var(--red);font-weight:600;">Not Connected</span><span style="color:var(--text-secondary);margin-left:6px;">‚Äî Check browser console for errors</span>';
  }
}

// ‚îÄ‚îÄ SHARED FORM HELPERS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function todayDate() {
  return new Date().toISOString().split('T')[0];
}
function nowDatetime() {
  const now = new Date();
  return new Date(now - now.getTimezoneOffset() * 60000).toISOString().slice(0,16);
}
function getCheckedValues(groupId) {
  const vals = [];
  document.querySelectorAll('#' + groupId + ' input[type="checkbox"]:checked').forEach(cb => vals.push(cb.value));
  return vals;
}
function initCheckboxGroup(groupId) {
  document.querySelectorAll('#' + groupId + ' .checkbox-label input').forEach(cb => {
    cb.addEventListener('change', () => cb.closest('.checkbox-label').classList.toggle('checked', cb.checked));
  });
}
function resetCheckboxGroup(groupId) {
  document.querySelectorAll('#' + groupId + ' input[type="checkbox"]').forEach(cb => {
    cb.checked = false;
    cb.closest('.checkbox-label').classList.remove('checked');
  });
}
let resultSelections = {};
function selectResult(prefix, value) {
  resultSelections[prefix] = value;
  ['pass','minor','fail'].forEach(r => {
    const btn = document.getElementById(prefix + '_' + r);
    if (!btn) return;
    btn.className = 'result-btn';
    if (r === value.toLowerCase()) btn.classList.add('selected-' + r);
  });
}
function resetResultBtns(prefix) {
  resultSelections[prefix] = null;
  ['pass','minor','fail'].forEach(r => {
    const btn = document.getElementById(prefix + '_' + r);
    if (btn) btn.className = 'result-btn';
  });
}
function updateFormState(noticeId, wrapId) {
  const notice = document.getElementById(noticeId);
  const wrap = document.getElementById(wrapId);
  if (!firebaseReady) {
    if (notice) notice.style.display = 'flex';
    if (wrap) wrap.style.display = 'none';
  } else {
    if (notice) notice.style.display = 'none';
    if (wrap) wrap.style.display = 'block';
  }
}

// ‚îÄ‚îÄ CALL LOG FORM ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function initCallLogForm() {
  const dt = document.getElementById('cl_datetime');
  if (dt && !dt.value) dt.value = nowDatetime();
  const sub = document.getElementById('cl_submitted_by');
  if (sub && currentUser) sub.value = currentUser.name;
  initCheckboxGroup('cl_units_group');
  renderPersonnelSelector();
  updateFormState('cl-config-notice','cl-form-wrap');
}

function submitCallLog() {
  if (!firebaseReady) { showToast('Firebase not connected. See Admin ‚Üí Firebase tab.','error'); return; }
  const dt = document.getElementById('cl_datetime').value;
  const type = document.getElementById('cl_type').value;
  const addr = document.getElementById('cl_address').value.trim();
  if (!dt || !type || !addr) { showToast('Date/Time, Incident Type, and Address are required','error'); return; }
  const units = getCheckedValues('cl_units_group');
  const personnel = getCheckedValues('cl_personnel_group');
  const uid = currentUser ? Object.keys(MEMBERS).find(k => MEMBERS[k] === currentUser) || 'unknown' : 'unknown';
  const btn = document.querySelector('#cl-form-wrap .btn-sm.primary');
  if (btn) { btn.disabled = true; btn.textContent = 'Saving‚Ä¶'; }
  db.collection('callLogs').add({
    incidentNumber:   document.getElementById('cl_incident_num').value.trim() || 'N/A',
    incidentType:     type,
    address:          addr,
    dateTime:         firebase.firestore.Timestamp.fromDate(new Date(dt)),
    unitsResponding:  units,
    personnelOnScene: personnel,
    mutualAid:        document.getElementById('cl_mutual_aid').checked,
    notes:            document.getElementById('cl_notes').value.trim(),
    submittedBy:      currentUser ? currentUser.name : 'Unknown',
    submittedByUid:   uid,
    createdAt:        firebase.firestore.FieldValue.serverTimestamp()
  }).then(() => {
    showToast('Call log submitted!','success');
    resetCallLogForm();
    if (btn) { btn.disabled = false; btn.textContent = 'üìã Submit Log'; }
  }).catch(err => {
    console.error(err);
    showToast('Failed to save. Check console.','error');
    if (btn) { btn.disabled = false; btn.textContent = 'üìã Submit Log'; }
  });
}

function resetCallLogForm() {
  ['cl_incident_num','cl_address','cl_personnel','cl_notes'].forEach(id => { const el = document.getElementById(id); if (el) el.value = ''; });
  document.getElementById('cl_type').value = '';
  document.getElementById('cl_mutual_aid').checked = false;
  resetCheckboxGroup('cl_units_group');
  resetCheckboxGroup('cl_personnel_group');
  document.getElementById('cl_datetime').value = nowDatetime();
}

function loadCallLogHistory() {
  const list = document.getElementById('calllog-submissions-list');
  if (!list) return;
  if (!firebaseReady) { list.innerHTML = '<div class="submissions-loading">Firebase not connected.</div>'; return; }
  list.innerHTML = '<div class="submissions-loading">Loading‚Ä¶</div>';
  db.collection('callLogs').orderBy('createdAt','desc').limit(50).get().then(snap => {
    if (snap.empty) { list.innerHTML = '<div class="submissions-loading">No submissions yet.</div>'; return; }
    const colorMap = {'Structure Fire':'red','Vehicle Accident':'amber','Medical':'blue','Brush Fire':'amber','HazMat':'gold','Other':'green'};
    list.innerHTML = snap.docs.map(doc => {
      const d = doc.data();
      const dtStr = d.dateTime ? d.dateTime.toDate().toLocaleString('en-US',{month:'2-digit',day:'2-digit',year:'2-digit',hour:'2-digit',minute:'2-digit'}) : '‚Äî';
      const clr = colorMap[d.incidentType] || 'blue';
      return `<div class="submission-card">
        <div class="submission-card-header">
          <span class="badge ${clr}">${d.incidentType||'Unknown'}</span>
          <span class="submission-card-meta">${dtStr}</span>
          ${d.incidentNumber&&d.incidentNumber!=='N/A'?`<span class="submission-card-meta" style="margin-left:auto;">#${d.incidentNumber}</span>`:''}
        </div>
        <div class="submission-card-row"><span class="submission-card-label">Location</span><span class="submission-card-value">${d.address||'‚Äî'}</span></div>
        <div class="submission-card-row"><span class="submission-card-label">Units</span><span class="submission-card-value">${d.unitsResponding?.join(', ')||'‚Äî'}</span></div>
        <div class="submission-card-row"><span class="submission-card-label">Personnel</span><span class="submission-card-value">${Array.isArray(d.personnelOnScene)?d.personnelOnScene.join(', ')||'‚Äî':d.personnelOnScene??'‚Äî'}</span></div>
        <div class="submission-card-row"><span class="submission-card-label">Mutual Aid</span><span class="submission-card-value" style="color:${d.mutualAid?'var(--amber)':'inherit'}">${d.mutualAid?'Yes':'No'}</span></div>
        ${d.notes?`<div class="submission-card-row" style="flex-direction:column;gap:3px;"><span class="submission-card-label">Notes</span><span class="submission-card-value" style="line-height:1.5;opacity:0.85;">${d.notes}</span></div>`:''}
        <div class="submission-card-row" style="margin-top:8px;padding-top:8px;border-top:1px solid var(--glass-border);"><span class="submission-card-label">Submitted by</span><span class="submission-card-value" style="color:var(--text-secondary);">${d.submittedBy||'‚Äî'}</span></div>
      </div>`;
    }).join('');
  }).catch(err => { console.error(err); list.innerHTML = '<div class="submissions-loading">Failed to load.</div>'; });
}

// ‚îÄ‚îÄ RESCUE CHECK FORM ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function initRescueForm() {
  const dt = document.getElementById('rs_date');
  if (dt && !dt.value) dt.value = todayDate();
  const sub = document.getElementById('rs_submitted_by');
  if (sub && currentUser) sub.value = currentUser.name;
  initCheckboxGroup('rs_equip_group');
  updateFormState('rs-config-notice','rs-form-wrap');
}

function submitRescueCheck() {
  if (!firebaseReady) { showToast('Firebase not connected.','error'); return; }
  const checkDate = document.getElementById('rs_date').value;
  if (!checkDate) { showToast('Check date is required','error'); return; }
  const result = resultSelections['rs'];
  if (!result) { showToast('Please select a result (Pass/Minor/Fail)','error'); return; }
  const uid = currentUser ? Object.keys(MEMBERS).find(k => MEMBERS[k] === currentUser) || 'unknown' : 'unknown';
  const btn = document.querySelector('#rs-form-wrap .btn-sm.primary');
  if (btn) { btn.disabled = true; btn.textContent = 'Saving‚Ä¶'; }
  db.collection('rescueChecks').add({
    unit:           'Rescue 412',
    checkDate:      firebase.firestore.Timestamp.fromDate(new Date(checkDate)),
    checkType:      document.getElementById('rs_check_type').value,
    oxygenLevel:    parseInt(document.getElementById('rs_o2').value) || null,
    equipmentChecked: getCheckedValues('rs_equip_group'),
    deficiencies:   document.getElementById('rs_deficiencies').value.trim(),
    result:         result,
    submittedBy:    currentUser ? currentUser.name : 'Unknown',
    submittedByUid: uid,
    createdAt:      firebase.firestore.FieldValue.serverTimestamp()
  }).then(() => {
    showToast('Rescue check submitted!','success');
    resetRescueForm();
    if (btn) { btn.disabled = false; btn.textContent = 'üöë Submit Check'; }
  }).catch(err => {
    console.error(err);
    showToast('Failed to save.','error');
    if (btn) { btn.disabled = false; btn.textContent = 'üöë Submit Check'; }
  });
}

function resetRescueForm() {
  document.getElementById('rs_date').value = todayDate();
  document.getElementById('rs_o2').value = '';
  document.getElementById('rs_deficiencies').value = '';
  resetCheckboxGroup('rs_equip_group');
  resetResultBtns('rs');
}

function loadRescueHistory() {
  const list = document.getElementById('rescue-submissions-list');
  if (!list) return;
  if (!firebaseReady) { list.innerHTML = '<div class="submissions-loading">Firebase not connected.</div>'; return; }
  list.innerHTML = '<div class="submissions-loading">Loading‚Ä¶</div>';
  db.collection('rescueChecks').orderBy('createdAt','desc').limit(50).get().then(snap => {
    if (snap.empty) { list.innerHTML = '<div class="submissions-loading">No submissions yet.</div>'; return; }
    const resColor = {'Pass':'green','Minor':'amber','Fail':'red'};
    list.innerHTML = snap.docs.map(doc => {
      const d = doc.data();
      const dtStr = d.checkDate ? d.checkDate.toDate().toLocaleDateString('en-US') : '‚Äî';
      const clr = resColor[d.result] || 'blue';
      return `<div class="submission-card">
        <div class="submission-card-header">
          <span class="badge ${clr}">${d.result||'‚Äî'}</span>
          <span class="submission-card-meta">${dtStr} ¬∑ ${d.checkType||''}</span>
          <span class="submission-card-meta" style="margin-left:auto;">${d.unit||''}</span>
        </div>
        ${d.oxygenLevel!=null?`<div class="submission-card-row"><span class="submission-card-label">O2 Level</span><span class="submission-card-value">${d.oxygenLevel}%</span></div>`:''}
        ${d.equipmentChecked?.length?`<div class="submission-card-row"><span class="submission-card-label">Equipment</span><span class="submission-card-value">${d.equipmentChecked.join(', ')}</span></div>`:''}
        ${d.deficiencies?`<div class="submission-card-row" style="flex-direction:column;gap:3px;"><span class="submission-card-label">Deficiencies</span><span class="submission-card-value" style="color:var(--amber);line-height:1.5;">${d.deficiencies}</span></div>`:''}
        <div class="submission-card-row" style="margin-top:8px;padding-top:8px;border-top:1px solid var(--glass-border);"><span class="submission-card-label">Submitted by</span><span class="submission-card-value" style="color:var(--text-secondary);">${d.submittedBy||'‚Äî'}</span></div>
      </div>`;
    }).join('');
  }).catch(err => { console.error(err); list.innerHTML = '<div class="submissions-loading">Failed to load.</div>'; });
}

// ‚îÄ‚îÄ TRUCK CHECK FORM ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function initTruckForm() {
  const dt = document.getElementById('tc_date');
  if (dt && !dt.value) dt.value = todayDate();
  const sub = document.getElementById('tc_submitted_by');
  if (sub && currentUser) sub.value = currentUser.name;
  initCheckboxGroup('tc_checklist_group');
  updateFormState('tc-config-notice','tc-form-wrap');
}

function submitTruckCheck() {
  if (!firebaseReady) { showToast('Firebase not connected.','error'); return; }
  const checkDate = document.getElementById('tc_date').value;
  const unit = document.getElementById('tc_unit').value;
  if (!checkDate || !unit) { showToast('Date and Unit are required','error'); return; }
  const result = resultSelections['tc'];
  if (!result) { showToast('Please select a result (Pass/Minor/Fail)','error'); return; }
  const uid = currentUser ? Object.keys(MEMBERS).find(k => MEMBERS[k] === currentUser) || 'unknown' : 'unknown';
  const btn = document.querySelector('#tc-form-wrap .btn-sm.primary');
  if (btn) { btn.disabled = true; btn.textContent = 'Saving‚Ä¶'; }
  db.collection('truckChecks').add({
    unit:           unit,
    checkDate:      firebase.firestore.Timestamp.fromDate(new Date(checkDate)),
    checkType:      document.getElementById('tc_check_type').value,
    checklistItems: getCheckedValues('tc_checklist_group'),
    deficiencies:   document.getElementById('tc_deficiencies').value.trim(),
    result:         result,
    submittedBy:    currentUser ? currentUser.name : 'Unknown',
    submittedByUid: uid,
    createdAt:      firebase.firestore.FieldValue.serverTimestamp()
  }).then(() => {
    showToast('Truck check submitted!','success');
    resetTruckForm();
    if (btn) { btn.disabled = false; btn.textContent = 'üöí Submit Check'; }
  }).catch(err => {
    console.error(err);
    showToast('Failed to save.','error');
    if (btn) { btn.disabled = false; btn.textContent = 'üöí Submit Check'; }
  });
}

function resetTruckForm() {
  document.getElementById('tc_date').value = todayDate();
  document.getElementById('tc_unit').value = '';
  document.getElementById('tc_deficiencies').value = '';
  resetCheckboxGroup('tc_checklist_group');
  resetResultBtns('tc');
}

function loadTruckHistory() {
  const list = document.getElementById('truck-submissions-list');
  if (!list) return;
  if (!firebaseReady) { list.innerHTML = '<div class="submissions-loading">Firebase not connected.</div>'; return; }
  list.innerHTML = '<div class="submissions-loading">Loading‚Ä¶</div>';
  db.collection('truckChecks').orderBy('createdAt','desc').limit(50).get().then(snap => {
    if (snap.empty) { list.innerHTML = '<div class="submissions-loading">No submissions yet.</div>'; return; }
    const resColor = {'Pass':'green','Minor':'amber','Fail':'red'};
    list.innerHTML = snap.docs.map(doc => {
      const d = doc.data();
      const dtStr = d.checkDate ? d.checkDate.toDate().toLocaleDateString('en-US') : '‚Äî';
      const clr = resColor[d.result] || 'blue';
      return `<div class="submission-card">
        <div class="submission-card-header">
          <span class="badge ${clr}">${d.result||'‚Äî'}</span>
          <span class="submission-card-meta">${dtStr} ¬∑ ${d.checkType||''}</span>
          <span class="submission-card-meta" style="margin-left:auto;">${d.unit||''}</span>
        </div>
        ${d.checklistItems?.length?`<div class="submission-card-row"><span class="submission-card-label">Checklist</span><span class="submission-card-value">${d.checklistItems.join(', ')}</span></div>`:''}
        ${d.deficiencies?`<div class="submission-card-row" style="flex-direction:column;gap:3px;"><span class="submission-card-label">Deficiencies</span><span class="submission-card-value" style="color:var(--amber);line-height:1.5;">${d.deficiencies}</span></div>`:''}
        <div class="submission-card-row" style="margin-top:8px;padding-top:8px;border-top:1px solid var(--glass-border);"><span class="submission-card-label">Submitted by</span><span class="submission-card-value" style="color:var(--text-secondary);">${d.submittedBy||'‚Äî'}</span></div>
      </div>`;
    }).join('');
  }).catch(err => { console.error(err); list.innerHTML = '<div class="submissions-loading">Failed to load.</div>'; });
}

// ‚îÄ‚îÄ ROSTER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let rosterCache = []; // { id, name, rank }

function loadRoster() {
  if (!firebaseReady) return;
  db.collection('roster').orderBy('name').get().then(snap => {
    rosterCache = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
    renderPersonnelSelector();
    renderRosterAdmin();
  }).catch(err => console.error('[CVFD] Roster load failed:', err));
}

function renderPersonnelSelector() {
  const group = document.getElementById('cl_personnel_group');
  if (!group) return;
  if (rosterCache.length === 0) {
    group.innerHTML = '<div style="color:var(--text-tertiary);font-size:13px;padding:8px 0;">No members in roster yet. Add members in Admin ‚Üí Members.</div>';
    return;
  }
  group.innerHTML = rosterCache.map(m =>
    `<label class="checkbox-label"><input type="checkbox" value="${m.name}"> ${m.name}${m.rank ? ' ¬∑ <span style="opacity:0.6;font-size:12px;">'+m.rank+'</span>' : ''}</label>`
  ).join('');
  initCheckboxGroup('cl_personnel_group');
}

function renderRosterAdmin() {
  const tbody = document.getElementById('rosterAdminTable');
  if (!tbody) return;
  if (rosterCache.length === 0) {
    tbody.innerHTML = '<tr><td colspan="4" style="text-align:center;color:var(--text-secondary);padding:20px;">No members yet. Add one above.</td></tr>';
    return;
  }
  tbody.innerHTML = rosterCache.map(m => `
    <tr>
      <td><strong>${m.name}</strong></td>
      <td>${m.rank || '‚Äî'}</td>
      <td><span style="font-family:'JetBrains Mono',monospace;font-size:11px;">${m.addedAt ? new Date(m.addedAt.toDate()).toLocaleDateString('en-US') : '‚Äî'}</span></td>
      <td><button class="action-btn deny" onclick="removeRosterMember('${m.id}','${m.name}')">Remove</button></td>
    </tr>`).join('');
}

function addRosterMember() {
  if (!firebaseReady) { showToast('Firebase not connected.','error'); return; }
  const name = document.getElementById('new_member_name').value.trim();
  const rank = document.getElementById('new_member_rank').value;
  if (!name) { showToast('Please enter a name','error'); return; }
  const btn = document.querySelector('#admin-members .btn-sm.primary');
  if (btn) { btn.disabled = true; btn.textContent = 'Adding‚Ä¶'; }
  db.collection('roster').add({
    name, rank: rank || '',
    addedAt: firebase.firestore.FieldValue.serverTimestamp()
  }).then(docRef => {
    rosterCache.push({ id: docRef.id, name, rank: rank || '', addedAt: null });
    rosterCache.sort((a,b) => a.name.localeCompare(b.name));
    renderRosterAdmin();
    renderPersonnelSelector();
    document.getElementById('new_member_name').value = '';
    document.getElementById('new_member_rank').value = '';
    showToast(`${name} added to roster!`, 'success');
    if (btn) { btn.disabled = false; btn.textContent = '+ Add Member'; }
  }).catch(err => {
    console.error(err);
    showToast('Failed to add member.','error');
    if (btn) { btn.disabled = false; btn.textContent = '+ Add Member'; }
  });
}

function removeRosterMember(id, name) {
  if (!firebaseReady) return;
  if (!confirm(`Remove ${name} from roster?`)) return;
  db.collection('roster').doc(id).delete().then(() => {
    rosterCache = rosterCache.filter(m => m.id !== id);
    renderRosterAdmin();
    renderPersonnelSelector();
    showToast(`${name} removed from roster`, 'info');
  }).catch(err => { console.error(err); showToast('Failed to remove.','error'); });
}

// ‚îÄ‚îÄ REMOVE old inline comment leftover ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Keyboard PIN is now handled natively by the pinTextInput element.
</script>
</body>
</html>
